<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>AgriSense Pro - Precision Farming Revolution</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="js/main.js" defer></script>


    <style>
        /* Comprehensive CSS with Professional Design and Extensive Features */
        :root {
            --primary-color: #4caf50;
            --secondary-color: #388e3c;
            --dark-color: #2e7d32;
            --light-color: #a5d6a7;
            --error-color: #c62828;
            --warning-color: #ff9800;
            --success-color: #43a047;
            --bg-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --shadow-light: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-dark: 0 10px 30px rgba(0,0,0,0.2);
            --shadow-heavy: 0 15px 50px rgba(0,0,0,0.3);
            --nav-bg: #ffffff;
            --nav-active: #e8f5e9;
            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #e8ecef;
            --highlight-color: #f0f4f0;
            --accent-color: #81c784;
            --danger-color: #d32f2f;
            --info-color: #0288d1;
            --background-light: #fafafa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #e8f5e9, #f5f5f5);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.5;
            font-size: 16px;
            padding: 0;
            margin: 0;
        }

        .phone-frame {
            width: 100%;
            height: 100vh;
            background: #fff;
            overflow: hidden;
            box-shadow: var(--shadow-dark);
            position: relative;
            margin: 0 auto;
            max-width: 100%;
            border: none;
            border-radius: 0;
        }

        /* Responsive text sizing */
        @media (min-width: 768px) {
            body {
                font-size: 16px;
            }
            .section-title {
                font-size: 18px;
            }
            .sensor-title {
                font-size: 17px;
            }
            .stat-value {
                font-size: 16px;
            }
        }

        @media (max-width: 767px) {
            body {
                font-size: 14px;
            }
            .section-title {
                font-size: 16px;
            }
            .sensor-title {
                font-size: 15px;
            }
            .stat-value {
                font-size: 14px;
            }
        }

        .header {
            background: var(--bg-gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 99;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            width: 100%;
            box-sizing: border-box;
            font-size: 14px;
            text-align: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
            animation: fadeIn 1.5s ease;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-icon {
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s, color 0.3s;
            color: white;
            text-decoration: none;
        }

        .header-icon:hover {
            transform: scale(1.15);
            color: var(--light-color);
        }

        .search-bar {
            margin: 10px;
            position: relative;
            animation: slideIn 0.8s ease;
            z-index: 25;
            background: #fff;
            border-radius: 20px;
            box-shadow: var(--shadow-light);
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .search-bar input {
            width: 100%;
            padding: 8px 35px 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: transparent;
        }

        .search-bar input:focus {
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.35);
            outline: none;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 16px;
            transition: color 0.4s;
        }

        .search-bar input:focus + .search-icon {
            color: var(--primary-color);
        }

        .content {
            height: calc(100vh - 105px);
            overflow-y: auto;
            padding: 10px 15px 100px 15px;
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f0f0f0;
            width: 100%;
            box-sizing: border-box;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            isolation: isolate;
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .section {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            max-width: 1400px;
            width: 100%;
        }
        
        /* Responsive content padding */
        @media (min-width: 1200px) {
            .content {
                padding: 20px 25px 120px 25px;
            }
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 8px 12px 80px 12px;
                height: calc(100vh - 95px);
            }
        }
        
        @media (max-width: 480px) {
            .content {
                padding: 5px 8px 70px 8px;
            }
        }

        .content::-webkit-scrollbar {
            width: 6px;
        }

        .content::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .content::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
            transition: background 0.4s;
        }

        .content::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        .section {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-light);
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
            border: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
            overflow: hidden;
            transform-origin: center;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-dark);
            background: var(--highlight-color);
        }

        .section-header {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            width: 100%;
        }
        
        /* Responsive section sizing */
        @media (max-width: 767px) {
            .section {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 8px;
            }
            
            .section-header {
                margin-bottom: 8px;
                padding-bottom: 6px;
            }
        }
        
        @media (min-width: 1400px) {
            .section {
                padding: 20px;
            }
        }

        .section-header .action-buttons {
            margin-top: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            width: 100%;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            width: 100%;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding: 0;
            width: 100%;
        }

        @media (max-width: 1600px) {
            .quick-stats {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 992px) {
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 6px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.3s, background 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
            width: 100%;
            box-sizing: border-box;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(76, 175, 80, 0.2);
            transform: rotate(45deg);
            transition: all 0.7s;
            opacity: 0;
        }

        .stat-card:hover::before {
            opacity: 1;
            top: 0;
            left: 0;
        }

        .stat-card:hover {
            transform: scale(1.03);
            background: var(--highlight-color);
            box-shadow: var(--shadow-dark);
        }

        .stat-icon {
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 6px;
            animation: pulse 2s infinite;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 900;
            color: var(--dark-color);
            margin-bottom: 4px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-bar {
    position: fixed !important;
    bottom: 20px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    background: linear-gradient(135deg, #43a047, #66bb6a, #2e7d32); /* Enhanced green gradient */
    padding: 14px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3), 0 0 15px rgba(76, 175, 80, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 16px;
    z-index: 9999 !important;
    transition: none !important;
    width: 95% !important;
    max-width: 750px !important;
    min-width: 320px !important;
    box-sizing: border-box;
    backdrop-filter: blur(8px);
    pointer-events: auto;
    opacity: 1 !important;
    visibility: visible !important;
}

.nav-item {
    flex: 1;
    color: rgba(255, 255, 255, 0.9);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 10px 8px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 700;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: transparent;
    min-width: 60px;
    overflow: visible;
    margin: 0 2px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

/* Responsive navigation */
@media (min-width: 992px) {
    .nav-item {
        min-width: 100px;
        margin: 0 12px;
    }

    .nav-bar {
        padding: 12px 20px;
    }
}

@media (max-width: 768px) {
    .nav-bar {
        padding: 10px;
        bottom: 15px !important;
        max-width: 90%;
    }

    .nav-item {
        margin: 0 5px;
        min-width: 50px;
        padding: 8px 5px;
    }

    .nav-item i {
        font-size: 20px !important;
    }

    .nav-item span {
        font-size: 10px !important;
    }
}

@media (max-width: 480px) {
    .nav-bar {
        padding: 8px 5px;
        bottom: 10px !important;
    }

    .nav-item {
        margin: 0 2px;
        padding: 5px 2px;
    }
}

.nav-item.active {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.25);
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.35), 0 3px 10px rgba(0,0,0,0.15);
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.nav-item:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-3px);
}

.nav-item i {
    font-size: 24px;
    margin-bottom: 6px;
    transition: transform 0.3s ease;
}

.nav-item:hover i {
    transform: scale(1.2);
}

.nav-item span {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 600;
    white-space: nowrap;
    overflow: visible;
    opacity: 1;
    display: block;
    width: 100%;
    text-align: center;
    line-height: 1.3;
}

.section {
    background: #fff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: 1px solid #e8ecef;
    width: 100%;
    box-sizing: border-box;
    max-width: 100%;
    overflow: hidden;
}

.section-header {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
    border-bottom: 1px solid #e8ecef;
    padding-bottom: 8px;
    width: 100%;
}

.section-title {
    font-size: 16px;
    font-weight: 700;
    color: #2e7d32;
    display: flex;
    align-items: center;
    gap: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    width: 100%;
}

.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 6px;
    width: 100%;
}

.btn {
    padding: 5px 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 3px;
    justify-content: center;
    text-decoration: none;
    color: white;
    background: #4caf50;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    margin: 2px;
}

.btn:hover {
    background: #388e3c;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.chart-container {
    position: relative;
    height: 320px;
    margin: 15px auto;
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chart-container canvas {
    width: 100% !important;
    height: 100% !important;
    max-width: 100%;
    max-height: 100%;
    margin: 0 auto;
}

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 15px auto;
            padding: 0;
            width: 100%;
            max-width: 100%;
        }
        
        @media (max-width: 1600px) {
            .sensor-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
        
        @media (max-width: 1200px) {
            .sensor-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .sensor-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
                margin: 10px auto;
            }
        }
        
        @media (max-width: 480px) {
            .sensor-grid {
                grid-template-columns: 1fr;
            }
        }

        .sensor-card {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-primary);
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .sensor-card.expanded {
            grid-column: 1;
            padding: 12px;
            background: var(--highlight-color);
            z-index: 20;
            box-shadow: var(--shadow-dark);
            border: 1px solid var(--primary-color);
        }

        .sensor-card:hover:not(.expanded) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-dark);
            border-color: var(--primary-color);
            background: #f8f9fa;
        }

        .sensor-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .sensor-icon {
            font-size: 18px;
            color: var(--primary-color);
            transition: transform 0.5s;
        }

        .sensor-card:hover .sensor-icon {
            transform: rotate(360deg);
        }

        .sensor-title {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 16px;
            transition: color 0.3s;
        }

        .sensor-card:hover .sensor-title {
            color: var(--primary-color);
        }

        .sensor-data {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 10px;
            transition: max-height 0.5s ease;
            max-height: 150px;
            overflow: hidden;
            line-height: 1.3;
            width: 100%;
        }

        .sensor-data div {
            margin-bottom: 3px;
            padding: 2px 4px;
            border-radius: 3px;
            background-color: rgba(250, 250, 250, 0.7);
        }

        .sensor-card.expanded .sensor-data {
            max-height: 1500px;
        }

        .btn {
            padding: 5px 8px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            justify-content: center;
            text-decoration: none;
            color: white;
            background: var(--primary-color);
            box-shadow: var(--shadow-light);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            margin: 2px;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-dark);
        }

        .btn.danger {
            background: var(--danger-color);
        }

        .btn.danger:hover {
            background: #b71c1c;
        }

        .btn.info {
            background: var(--info-color);
        }

        .btn.info:hover {
            background: #01579b;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
            justify-content: flex-start;
            width: 100%;
            align-items: center;
        }

        .weather-card {
            background: linear-gradient(135deg, #4fc3f7, #2196f3);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            animation: weatherPulse 3s infinite;
            box-shadow: var(--shadow-light);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .weather-card:hover {
            transform: scale(1.03);
            box-shadow: var(--shadow-dark);
        }

        .weather-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .weather-temp {
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .weather-desc {
            font-size: 16px;
            opacity: 0.9;
            font-style: italic;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .notification-list {
            margin-top: 20px;
            width: 100%;
        }

        .notification-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            background: #fff;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            width: 100%;
            box-sizing: border-box;
        }

        .notification-item:hover {
            background: var(--highlight-color);
            transform: translateX(10px);
            box-shadow: var(--shadow-dark);
        }

        .notification-icon {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: transform 0.4s;
        }

        .notification-item:hover .notification-icon {
            transform: scale(1.25);
        }

        .notification-icon.warning {
            background: rgba(255, 152, 0, 0.25);
            color: var(--warning-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 900;
            margin-bottom: 15px;
            font-size: 24px;
            color: var(--dark-color);
        }

        .notification-text {
            font-size: 18px;
            color: var(--text-secondary);
        }

        .notification-time {
            font-size: 16px;
            color: #999;
            margin-top: 15px;
            font-style: italic;
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin: 15px auto;
            background: #fff;
            border-radius: 8px;
            padding: 12px;
            box-shadow: var(--shadow-light);
            transition: height 0.4s ease;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            transform-origin: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
            margin: 0 auto;
        }
        
        /* Responsive chart sizing */
        @media (min-width: 1200px) {
            .chart-container {
                height: 350px;
            }
        }
        
        @media (max-width: 767px) {
            .chart-container {
                height: 200px;
                padding: 8px;
                margin: 10px auto;
            }
        }

        .form-group {
            margin-bottom: 20px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: #fff;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.25);
            outline: none;
        }

        .view {
            display: none;
            width: 100%;
            animation: none;
            opacity: 0;
            visibility: hidden;
            margin: 0 auto;
            max-width: 1100px;
        }

        .view.active {
            display: block !important;
            animation: fadeIn 0.7s ease;
            opacity: 1;
            visibility: visible;
        }

        .settings-panel {
            padding: 15px;
            background: var(--highlight-color);
            border-radius: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }

        .settings-option {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s;
        }

        .settings-option:hover {
            background: rgba(76, 175, 80, 0.15);
        }

        .weather-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .cloud {
            position: absolute;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 30px;
            animation: moveCloud 20s linear infinite;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .sensor-details {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f0f4f0;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }

        .sensor-card.expanded .sensor-details {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .crop-info {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 12px;
            box-shadow: inset 0 0 10px rgba(76, 175, 80, 0.2);
            border: 1px solid var(--accent-color);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: flex-start;
            width: 100%;
            align-items: center;
        }

        .status-indicator {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 15px;
            transition: background 0.4s;
        }

        .status-indicator.active { background: var(--success-color); }
        .status-indicator.warning { background: var(--warning-color); }
        .status-indicator.error { background: var(--error-color); }
        .status-indicator.offline { background: #9e9e9e; }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.6s ease;
        }

        .task-list {
            margin-top: 40px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 15px;
            background: #fff;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.5s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            width: 100%;
            box-sizing: border-box;
        }

        .task-item:hover {
            background: var(--highlight-color);
            transform: translateX(20px);
            box-shadow: var(--shadow-dark);
        }

        .task-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            background: rgba(76, 175, 80, 0.2);
            color: var(--primary-color);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 900;
            margin-bottom: 10px;
            font-size: 22px;
            color: var(--dark-color);
        }

        .task-details {
            font-size: 17px;
            color: var(--text-secondary);
        }

        @keyframes moveCloud {
            0% { transform: translateX(-200px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(900px); opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(35px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateY(-45px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        @keyframes weatherPulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="header">
            <div class="header-title">
                <i class="fas fa-leaf"></i>
                AgriSense Pro
            </div>
            <div class="header-actions">
                <span class="header-icon" onclick="switchView('notifications')" title="View Notifications"><i class="fas fa-bell"></i></span>
                <span class="header-icon" onclick="switchView('account')" title="Manage Account"><i class="fas fa-user"></i></span>
                <span class="header-icon" onclick="window.location.href='settings.html'" title="Adjust Settings"><i class="fas fa-cog"></i></span>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search sensors, crops, alerts..." onkeyup="performSearch()">
            <i class="fas fa-search search-icon"></i>
        </div>

        <div class="content">
            <!-- Ultra-Detailed Home View -->
            <div class="view home-view active">
                <!-- Command Center Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-tachometer-alt"></i>
                            Farm Command Center
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="toggleLiveUpdate()" title="Toggle Live Data Updates">Live: <span id="liveStatus">Off</span></span>
                            <span class="btn" onclick="exportData()" title="Export All Farm Data">Export Data</span>
                            <span class="btn" onclick="generateReport()" title="Generate Comprehensive Report">Generate Report</span>
                            <span class="btn" onclick="runDiagnostics()" title="Run System Diagnostics">Diagnostics</span>
                            <span class="btn" onclick="syncAll()" title="Sync All Systems">Sync All</span>
                        </div>
                    </div>
                    <div class="quick-stats" id="quickStats">
                        <div class="stat-card" onclick="switchView('sensors')" title="Temperature Overview">
                            <i class="fas fa-thermometer-half stat-icon"></i>
                            <div class="stat-value" id="avgTemp">72°F</div>
                            <div class="stat-label">Avg Temperature</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 72%;" id="tempProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('sensors')" title="Humidity Overview">
                            <i class="fas fa-tint stat-icon"></i>
                            <div class="stat-value" id="avgHumidity">65%</div>
                            <div class="stat-label">Avg Humidity</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 65%;" id="humidProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('sensors')" title="Light Overview">
                            <i class="fas fa-sun stat-icon"></i>
                            <div class="stat-value" id="avgLight">14 Dli</div>
                            <div class="stat-label">Avg Light</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 70%;" id="lightProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('sensors')" title="pH Overview">
                            <i class="fas fa-flask stat-icon"></i>
                            <div class="stat-value" id="avgPh">7.5</div>
                            <div class="stat-label">Avg pH</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 75%;" id="phProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('sensors')" title="Battery Status">
                            <i class="fas fa-battery-full stat-icon"></i>
                            <div class="stat-value" id="avgBattery">90%</div>
                            <div class="stat-label">Avg Battery</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 90%;" id="batteryProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('notifications')" title="Active Alerts">
                            <i class="fas fa-bell stat-icon"></i>
                            <div class="stat-value" id="alertCount">1</div>
                            <div class="stat-label">Active Alerts</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 10%;" id="alertProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('analytics')" title="Crop Health Index">
                            <i class="fas fa-leaf stat-icon"></i>
                            <div class="stat-value" id="cropHealth">87%</div>
                            <div class="stat-label">Crop Health</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 87%;" id="healthProgress"></div></div>
                        </div>
                        <div class="stat-card" onclick="switchView('analytics')" title="Water Usage">
                            <i class="fas fa-water stat-icon"></i>
                            <div class="stat-value" id="waterUsage">500 gal</div>
                            <div class="stat-label">Water Today</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 50%;" id="waterProgress"></div></div>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="overviewChart"></canvas>
                    </div>
                </div>

                <!-- Crop Operations Dashboard -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-seedling"></i>
                            Crop Operations Dashboard
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="switchView('analytics')" title="Analyze Crop Trends">Analyze Trends</span>
                            <span class="btn" onclick="scheduleIrrigation()" title="Schedule Farm-Wide Irrigation">Irrigate All</span>
                            <span class="btn" onclick="applyFertilizer()" title="Apply Fertilizer to All Crops">Fertilize All</span>
                            <span class="btn" onclick="monitorPests()" title="Monitor Pest Activity">Pest Control</span>
                            <span class="btn" onclick="addCrop()" title="Add New Crop">Add Crop</span>
                        </div>
                    </div>
                    <div class="sensor-grid" id="cropGrid">
                        <div class="sensor-card" onclick="toggleCrop(this, 'Corn')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Corn Fields</span>
                                <span class="status-indicator active" title="Crop Healthy"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Sensors: 2 Active</div>
                                <div>Health: <span id="cornHealth">Good</span></div>
                                <div>Water Need: <span id="cornWater">Moderate</span></div>
                                <div>Yield Forecast: <span id="cornYield">85%</span></div>
                                <div>Growth: Flowering</div>
                            </div>
                            <div class="sensor-details crop-info">
                                <div>Crop Type: Corn</div>
                                <div>Variety: Golden Hybrid</div>
                                <div>Planting Date: 2023-04-15</div>
                                <div>Expected Harvest: 2023-09-30</div>
                                <div>Soil Moisture: <span id="cornMoisture">65%</span></div>
                                <div>Temperature: <span id="cornTemp">72°F</span></div>
                                <div>Light Exposure: <span id="cornLight">14 Dli</span></div>
                                <div>pH Level: <span id="cornPh">7.5</span></div>
                                <div>Growth Stage: Flowering</div>
                                <div>Nutrient Status: Optimal</div>
                                <div>Pest Risk: Low</div>
                                <div>Irrigation Last: 2023-11-27</div>
                                <div>Fertilizer Last: 2023-11-20</div>
                                <div>Acreage: 75 Acres</div>
                                <div>Plant Density: 30,000/acre</div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 60%;" title="Growth Progress"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="cornChart"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="scheduleIrrigation('Corn')" title="Irrigate Corn Fields">Irrigate</span>
                                    <span class="btn" onclick="applyFertilizer('Corn')" title="Fertilize Corn Fields">Fertilize</span>
                                    <span class="btn" onclick="monitorPests('Corn')" title="Monitor Pests in Corn">Pest Check</span>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-card" onclick="toggleCrop(this, 'Wheat')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Wheat Fields</span>
                                <span class="status-indicator active" title="Crop Healthy"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Sensors: 2 Active</div>
                                <div>Health: <span id="wheatHealth">Excellent</span></div>
                                <div>Water Need: <span id="wheatWater">Low</span></div>
                                <div>Yield Forecast: <span id="wheatYield">90%</span></div>
                                <div>Growth: Grain Fill</div>
                            </div>
                            <div class="sensor-details crop-info">
                                <div>Crop Type: Wheat</div>
                                <div>Variety: Winter Red</div>
                                <div>Planting Date: 2023-03-20</div>
                                <div>Expected Harvest: 2023-08-15</div>
                                <div>Soil Moisture: <span id="wheatMoisture">63%</span></div>
                                <div>Temperature: <span id="wheatTemp">71°F</span></div>
                                <div>Light Exposure: <span id="wheatLight">13.8 Dli</span></div>
                                <div>pH Level: <span id="wheatPh">7.4</span></div>
                                <div>Growth Stage: Grain Fill</div>
                                <div>Nutrient Status: High</div>
                                <div>Pest Risk: Minimal</div>
                                <div>Irrigation Last: 2023-11-26</div>
                                <div>Fertilizer Last: 2023-11-19</div>
                                <div>Acreage: 60 Acres</div>
                                <div>Plant Density: 35,000/acre</div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 75%;" title="Growth Progress"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="wheatChart"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="scheduleIrrigation('Wheat')" title="Irrigate Wheat Fields">Irrigate</span>
                                    <span class="btn" onclick="applyFertilizer('Wheat')" title="Fertilize Wheat Fields">Fertilize</span>
                                    <span class="btn" onclick="monitorPests('Wheat')" title="Monitor Pests in Wheat">Pest Check</span>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-card" onclick="toggleCrop(this, 'Soybeans')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Soybean Fields</span>
                                <span class="status-indicator active" title="Crop Healthy"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Sensors: 0 Active</div>
                                <div>Health: <span id="soyHealth">Good</span></div>
                                <div>Water Need: <span id="soyWater">Moderate</span></div>
                                <div>Yield Forecast: <span id="soyYield">82%</span></div>
                                <div>Growth: Pod Setting</div>
                            </div>
                            <div class="sensor-details crop-info">
                                <div>Crop Type: Soybeans</div>
                                <div>Variety: Green Pride</div>
                                <div>Planting Date: 2023-05-01</div>
                                <div>Expected Harvest: 2023-10-10</div>
                                <div>Soil Moisture: <span id="soyMoisture">66%</span></div>
                                <div>Temperature: <span id="soyTemp">73°F</span></div>
                                <div>Light Exposure: <span id="soyLight">14.5 Dli</span></div>
                                <div>pH Level: <span id="soyPh">7.6</span></div>
                                <div>Growth Stage: Pod Setting</div>
                                <div>Nutrient Status: Adequate</div>
                                <div>Pest Risk: Low</div>
                                <div>Irrigation Last: 2023-11-28</div>
                                <div>Fertilizer Last: 2023-11-21</div>
                                <div>Acreage: 15 Acres</div>
                                <div>Plant Density: 28,000/acre</div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 55%;" title="Growth Progress"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="soyChart"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="scheduleIrrigation('Soybeans')" title="Irrigate Soybean Fields">Irrigate</span>
                                    <span class="btn" onclick="applyFertilizer('Soybeans')" title="Fertilize Soybean Fields">Fertilize</span>
                                    <span class="btn" onclick="monitorPests('Soybeans')" title="Monitor Pests in Soybeans">Pest Check</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>

                <!-- Sensor Network Operations -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-satellite"></i>
                            Sensor Network Operations
                        </h2>
                        <div class="action-buttons">
                            <span class="btn btn-primary" onclick="switchView('add-sensor')" title="Deploy New Sensor">
                                <i class="fas fa-plus"></i> Add Sensor
                            </span>
                            <span class="btn" onclick="toggleAllSensors()" title="Expand/Collapse All Sensors">Expand All</span>
                            <span class="btn" onclick="switchView('sensors')" title="Manage Sensors in Detail">Manage Sensors</span>
                            <span class="btn" onclick="calibrateSensors()" title="Calibrate All Sensors">Calibrate All</span>
                            <span class="btn" onclick="syncSensors()" title="Sync Sensor Data">Sync Data</span>
                            <span class="btn danger" onclick="resetSensors()" title="Reset All Sensors">Reset All</span>
                        </div>
                    </div>
                    <div class="sensor-grid" id="sensorGrid">
                        <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 1')">
                            <div class="sensor-header">
                                <i class="fas fa-microchip sensor-icon"></i>
                                <span class="sensor-title">Sensor 1</span>
                                <span class="status-indicator active" title="Sensor Active"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Temp: <span id="temp1">72°F</span></div>
                                <div>Humidity: <span id="humid1">65%</span></div>
                                <div>Light: <span id="light1">14 Dli</span></div>
                                <div>pH: <span id="ph1">7.5</span></div>
                                <div>Battery: <span id="battery1">95%</span></div>
                            </div>
                            <div class="sensor-details">
                                <div>Status: Active<span class="status-indicator active"></span></div>
                                <div>Location: Corn Field A, Row 1</div>
                                <div>Crop Monitored: Corn</div>
                                <div>Last Calibration: 2023-11-25</div>
                                <div>Installation Date: 2023-01-15</div>
                                <div>Sensor ID: FS-001</div>
                                <div>Last Reading: <span id="lastReading1">${new Date().toLocaleString()}</span></div>
                                <div>Signal Strength: 92%</div>
                                <div>Power Source: Solar + Battery</div>
                                <div>Firmware Version: 2.1.3</div>
                                <div>Operating Temp: 32°F - 120°F</div>
                                <div class="crop-info">
                                    <div>Crop Type: Corn</div>
                                    <div>Variety: Golden Hybrid</div>
                                    <div>Health: Good</div>
                                    <div>Water Need: Moderate</div>
                                    <div>Growth Stage: Flowering</div>
                                    <div>Last Irrigation: 2023-11-27</div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 95%;" title="Battery Level"></div></div>
                                <div class="chart-container" style="height: 180px;">
                                    <canvas id="sensorChart1"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="switchView('sensors')" title="View Full Sensor Details">Full View</span>
                                    <span class="btn danger" onclick="deactivateSensor('Sensor 1')" title="Deactivate Sensor">Deactivate</span>
                                    <span class="btn info" onclick="calibrateSensor('Sensor 1')" title="Calibrate Sensor">Calibrate</span>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 2')">
                            <div class="sensor-header">
                                <i class="fas fa-microchip sensor-icon"></i>
                                <span class="sensor-title">Sensor 2</span>
                                <span class="status-indicator active" title="Sensor Active"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Temp: <span id="temp2">71°F</span></div>
                                <div>Humidity: <span id="humid2">64%</span></div>
                                <div>Light: <span id="light2">13.8 Dli</span></div>
                                <div>pH: <span id="ph2">7.4</span></div>
                                <div>Battery: <span id="battery2">88%</span></div>
                            </div>
                            <div class="sensor-details">
                                <div>Status: Active<span class="status-indicator active"></span></div>
                                <div>Location: Corn Field A, Row 2</div>
                                <div>Crop Monitored: Corn</div>
                                <div>Last Calibration: 2023-11-24</div>
                                <div>Installation Date: 2023-01-16</div>
                                <div>Sensor ID: FS-002</div>
                                <div>Last Reading: <span id="lastReading2">${new Date().toLocaleString()}</span></div>
                                <div>Signal Strength: 88%</div>
                                <div>Power Source: Battery</div>
                                <div>Firmware Version: 2.1.2</div>
                                <div>Operating Temp: 32°F - 120°F</div>
                                <div class="crop-info">
                                    <div>Crop Type: Corn</div>
                                    <div>Variety: Golden Hybrid</div>
                                    <div>Health: Good</div>
                                    <div>Water Need: Moderate</div>
                                    <div>Growth Stage: Flowering</div>
                                    <div>Last Irrigation: 2023-11-27</div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 88%;" title="Battery Level"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="sensorChart2"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="switchView('sensors')" title="View Full Sensor Details">Full View</span>
                                    <span class="btn danger" onclick="deactivateSensor('Sensor 2')" title="Deactivate Sensor">Deactivate</span>
                                    <span class="btn info" onclick="calibrateSensor('Sensor 2')" title="Calibrate Sensor">Calibrate</span>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 3')">
                            <div class="sensor-header">
                                <i class="fas fa-microchip sensor-icon"></i>
                                <span class="sensor-title">Sensor 3</span>
                                <span class="status-indicator active" title="Sensor Active"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Temp: <span id="temp3">73°F</span></div>
                                <div>Humidity: <span id="humid3">66%</span></div>
                                <div>Light: <span id="light3">14.2 Dli</span></div>
                                <div>pH: <span id="ph3">7.6</span></div>
                                <div>Battery: <span id="battery3">92%</span></div>
                            </div>
                            <div class="sensor-details">
                                <div>Status: Active<span class="status-indicator active"></span></div>
                                <div>Location: Wheat Field B, Row 1</div>
                                <div>Crop Monitored: Wheat</div>
                                <div>Last Calibration: 2023-11-23</div>
                                <div>Installation Date: 2023-01-17</div>
                                <div>Sensor ID: FS-003</div>
                                <div>Last Reading: <span id="lastReading3">${new Date().toLocaleString()}</span></div>
                                <div>Signal Strength: 90%</div>
                                <div>Power Source: Solar</div>
                                <div>Firmware Version: 2.1.3</div>
                                <div>Operating Temp: 32°F - 120°F</div>
                                <div class="crop-info">
                                    <div>Crop Type: Wheat</div>
                                    <div>Variety: Winter Red</div>
                                    <div>Health: Excellent</div>
                                    <div>Water Need: Low</div>
                                    <div>Growth Stage: Grain Fill</div>
                                    <div>Last Irrigation: 2023-11-26</div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 92%;" title="Battery Level"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="sensorChart3"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="switchView('sensors')" title="View Full Sensor Details">Full View</span>
                                    <span class="btn danger" onclick="deactivateSensor('Sensor 3')" title="Deactivate Sensor">Deactivate</span>
                                    <span class="btn info" onclick="calibrateSensor('Sensor 3')" title="Calibrate Sensor">Calibrate</span>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 4')">
                            <div class="sensor-header">
                                <i class="fas fa-microchip sensor-icon"></i>
                                <span class="sensor-title">Sensor 4</span>
                                <span class="status-indicator active" title="Sensor Active"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Temp: <span id="temp4">70°F</span></div>
                                <div>Humidity: <span id="humid4">63%</span></div>
                                <div>Light: <span id="light4">13.5 Dli</span></div>
                                <div>pH: <span id="ph4">7.3</span></div>
                                <div>Battery: <span id="battery4">90%</span></div>
                            </div>
                            <div class="sensor-details">
                                <div>Status: Active<span class="status-indicator active"></span></div>
                                <div>Location: Wheat Field B, Row 2</div>
                                <div>Crop Monitored: Wheat</div>
                                <div>Last Calibration: 2023-11-22</div>
                                <div>Installation Date: 2023-01-18</div>
                                <div>Sensor ID: FS-004</div>
                                <div>Last Reading: <span id="lastReading4">${new Date().toLocaleString()}</span></div>
                                <div>Signal Strength: 89%</div>
                                <div>Power Source: Battery</div>
                                <div>Firmware Version: 2.1.2</div>
                                <div>Operating Temp: 32°F - 120°F</div>
                                <div class="crop-info">
                                    <div>Crop Type: Wheat</div>
                                    <div>Variety: Winter Red</div>
                                    <div>Health: Excellent</div>
                                    <div>Water Need: Low</div>
                                    <div>Growth Stage: Grain Fill</div>
                                    <div>Last Irrigation: 2023-11-26</div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 90%;" title="Battery Level"></div></div>
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="sensorChart4"></canvas>
                                </div>
                                <div class="action-buttons">
                                    <span class="btn" onclick="switchView('sensors')" title="View Full Sensor Details">Full View</span>
                                    <span class="btn danger" onclick="deactivateSensor('Sensor 4')" title="Deactivate Sensor">Deactivate</span>
                                    <span class="btn info" onclick="calibrateSensor('Sensor 4')" title="Calibrate Sensor">Calibrate</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                <!-- Weather Command Station -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-cloud-sun"></i>
                            Weather Command Station
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="switchView('weather')" title="View Detailed Weather Forecast">Full Forecast</span>
                            <span class="btn" onclick="updateWeatherAlerts()" title="Refresh Weather Alerts">Check Alerts</span>
                            <span class="btn" onclick="adjustIrrigation()" title="Adjust Irrigation Based on Weather">Adjust Irrigation</span>
                            <span class="btn" onclick="downloadWeatherData()" title="Download Weather Data">Download Data</span>
                            <span class="btn" onclick="setWeatherThresholds()" title="Set Weather Thresholds">Set Thresholds</span>
                        </div>
                    </div>
                    <div class="weather-card" onclick="switchView('weather')">
                        <div class="weather-animation">
                            <div class="cloud" style="top: 35px; animation-delay: 0s;"></div>
                            <div class="cloud" style="top: 90px; animation-delay: 2s;"></div>
                            <div class="cloud" style="top: 145px; animation-delay: 4s;"></div>
                            <div class="cloud" style="top: 200px; animation-delay: 6s;"></div>
                            <div class="cloud" style="top: 255px; animation-delay: 8s;"></div>
                        </div>
                        <div class="weather-info">
                            <div>
                                <div class="weather-temp" id="weatherTemp">72°F</div>
                                <div class="weather-desc" id="weatherDesc">Partly Cloudy</div>
                            </div>
                            <i class="fas fa-cloud-sun fa-3x"></i>
                        </div>
                        <div class="sensor-data" style="margin-top: 35px;">
                            <div>Humidity: <span id="weatherHumid">65%</span></div>
                            <div>Wind Speed: 8 mph</div>
                            <div>Wind Direction: NW</div>
                            <div>Pressure: 1013 hPa</div>
                            <div>UV Index: 6</div>
                            <div>Temperature High: 75°F</div>
                            <div>Temperature Low: 68°F</div>
                            <div>Precipitation Chance: 10%</div>
                            <div>Visibility: 10 miles</div>
                        </div>
                        <div class="action-buttons" style="margin-top: 35px;">
                            <span class="btn" onclick="viewHourlyForecast()" title="View Hourly Forecast">Hourly Forecast</span>
                            <span class="btn" onclick="viewWeeklyForecast()" title="View Weekly Forecast">Weekly Forecast</span>
                        </div>
                    </div>
                </div>

                <!-- Farm Operations Toolkit -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-tools"></i>
                            Farm Operations Toolkit
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="viewAllActions()" title="View All Available Actions">All Actions</span>
                            <span class="btn" onclick="scheduleTask()" title="Schedule a New Task">Add Task</span>
                            <span class="btn" onclick="viewTaskHistory()" title="View Task History">Task History</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <span class="btn" onclick="scheduleIrrigation()" title="Irrigate All Fields">Irrigate Fields</span>
                        <span class="btn" onclick="orderFertilizer()" title="Order Fertilizer Supplies">Order Fertilizer</span>
                        <span class="btn" onclick="scheduleMaintenance()" title="Schedule Sensor Maintenance">Sensor Maintenance</span>
                        <span class="btn" onclick="contactSupport()" title="Contact Technical Support">Contact Support</span>
                        <span class="btn" onclick="checkEquipment()" title="Check Equipment Status">Equipment Status</span>
                        <span class="btn" onclick="updateFirmware()" title="Update Sensor Firmware">Update Firmware</span>
                        <span class="btn" onclick="orderSeeds()" title="Order Seeds for Planting">Order Seeds</span>
                        <span class="btn" onclick="manageInventory()" title="Manage Farm Inventory">Manage Inventory</span>
                    </div>
                    <div class="sensor-grid" style="margin-top: 40px;">
                        <div class="sensor-card" onclick="viewTaskStatus()">
                            <div class="sensor-header">
                                <i class="fas fa-tasks sensor-icon"></i>
                                <span class="sensor-title">Task Management</span>
                            </div>
                            <div class="sensor-data">
                                <div>Pending Tasks: <span id="pendingTasks">3</span></div>
                                <div>Completed Today: <span id="completedTasks">5</span></div>
                                <div>Overdue: <span id="overdueTasks">0</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 60%;" title="Task Completion"></div></div>
                        </div>
                        <div class="sensor-card" onclick="viewInventory()">
                            <div class="sensor-header">
                                <i class="fas fa-warehouse sensor-icon"></i>
                                <span class="sensor-title">Inventory Status</span>
                            </div>
                            <div class="sensor-data">
                                <div>Fertilizer: <span id="fertilizerStock">500 kg</span></div>
                                <div>Water Reserves: <span id="waterStock">1000 gal</span></div>
                                <div>Seeds: <span id="seedStock">200 kg</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 75%;" title="Inventory Levels"></div></div>
                        </div>
                        <div class="sensor-card" onclick="viewEquipment()">
                            <div class="sensor-header">
                                <i class="fas fa-tractor sensor-icon"></i>
                                <span class="sensor-title">Equipment Health</span>
                            </div>
                            <div class="sensor-data">
                                <div>Tractors: 2 Active</div>
                                <div>Irrigators: 1 Active</div>
                                <div>Maintenance Due: <span id="equipMaintenance">1</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 80%;" title="Equipment Readiness"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Farm Performance Analytics -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-chart-pie"></i>
                            Farm Performance Analytics
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="switchView('analytics')" title="View Detailed Analytics">Detailed Analytics</span>
                            <span class="btn" onclick="compareSeasons()" title="Compare with Previous Seasons">Compare Seasons</span>
                            <span class="btn" onclick="setPerformanceGoals()" title="Set Performance Goals">Set Goals</span>
                        </div>
                    </div>
                    <div class="sensor-grid">
                        <div class="sensor-card" onclick="switchView('analytics')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Yield Forecast</span>
                            </div>
                            <div class="sensor-data">
                                <div>Corn: <span id="cornYield">85%</span></div>
                                <div>Wheat: <span id="wheatYield">90%</span></div>
                                <div>Soybeans: <span id="soyYield">82%</span></div>
                                <div>Avg Yield: <span id="avgYield">87%</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 87%;" title="Average Yield"></div></div>
                        </div>
                        <div class="sensor-card" onclick="switchView('analytics')">
                            <div class="sensor-header">
                                <i class="fas fa-water sensor-icon"></i>
                                <span class="sensor-title">Resource Efficiency</span>
                            </div>
                            <div class="sensor-data">
                                <div>Water Daily: <span id="waterDaily">500 gal</span></div>
                                <div>Fertilizer Weekly: <span id="fertilizerWeekly">50 kg</span></div>
                                <div>Energy Use: <span id="energyUse">120 kWh</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 60%;" title="Resource Efficiency"></div></div>
                        </div>
                        <div class="sensor-card" onclick="switchView('analytics')">
                            <div class="sensor-header">
                                <i class="fas fa-bug sensor-icon"></i>
                                <span class="sensor-title">Pest & Disease Index</span>
                            </div>
                            <div class="sensor-data">
                                <div>Pest Risk: <span id="pestRisk">Low</span></div>
                                <div>Disease Index: <span id="diseaseIndex">2/10</span></div>
                                <div>Incidents: <span id="pestIncidents">0</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 20%;" title="Pest/Disease Impact"></div></div>
                        </div>
                        <div class="sensor-card" onclick="switchView('analytics')">
                            <div class="sensor-header">
                                <i class="fas fa-dollar-sign sensor-icon"></i>
                                <span class="sensor-title">Cost Management</span>
                            </div>
                            <div class="sensor-data">
                                <div>Water Cost: <span id="waterCost">$50</span></div>
                                <div>Fertilizer Cost: <span id="fertilizerCost">$200</span></div>
                                <div>Total Daily: <span id="totalCost">$250</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 45%;" title="Cost Efficiency"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Farm Activity Command Log -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Farm Activity Command Log
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="viewFullLog()" title="View Complete Activity Log">Full Log</span>
                            <span class="btn" onclick="clearLog()" title="Clear Activity Log">Clear Log</span>
                            <span class="btn" onclick="exportLog()" title="Export Activity Log">Export Log</span>
                        </div>
                    </div>
                    <div class="task-list" id="activityLog">
                        <div class="task-item">
                            <div class="task-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Irrigation Completed</div>
                                <div class="task-details">Corn Field A irrigated with 200 gal on 2023-11-28 08:00</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Fertilizer Applied</div>
                                <div class="task-details">Wheat Field B fertilized with 20 kg on 2023-11-27 14:30</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Sensor Maintenance</div>
                                <div class="task-details">Sensor 3 serviced on 2023-11-26 10:00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Predictive Analytics Hub -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-brain"></i>
                            Predictive Analytics Hub
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="predictCropHealth('Corn')" title="Predict Corn Health">Predict Corn</span>
                            <span class="btn" onclick="predictCropHealth('Wheat')" title="Predict Wheat Health">Predict Wheat</span>
                            <span class="btn" onclick="predictCropHealth('Soybeans')" title="Predict Soybean Health">Predict Soybeans</span>
                            <span class="btn" onclick="analyzeWeatherImpact()" title="Analyze Weather Impact">Weather Impact</span>
                            <span class="btn" onclick="analyzeEconomics()" title="Economic Analysis">Economic Report</span>
                        </div>
                    </div>
                    <div class="sensor-grid">
                        <div class="sensor-card" onclick="predictCropHealth('Corn')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Corn Prediction</span>
                            </div>
                            <div class="sensor-data">
                                <div>Health: <span id="cornHealthPred">Good</span></div>
                                <div>Confidence: <span id="cornConfidence">85%</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 85%;" title="Prediction Confidence"></div></div>
                        </div>
                        <div class="sensor-card" onclick="predictCropHealth('Wheat')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Wheat Prediction</span>
                            </div>
                            <div class="sensor-data">
                                <div>Health: <span id="wheatHealthPred">Excellent</span></div>
                                <div>Confidence: <span id="wheatConfidence">90%</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 90%;" title="Prediction Confidence"></div></div>
                        </div>
                        <div class="sensor-card" onclick="predictCropHealth('Soybeans')">
                            <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Soybean Prediction</span>
                            </div>
                            <div class="sensor-data">
                                <div>Health: <span id="soyHealthPred">Good</span></div>
                                <div>Confidence: <span id="soyConfidence">82%</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 82%;" title="Prediction Confidence"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Resource Management Dashboard -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-cubes"></i>
                            Resource Management Dashboard
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="orderFertilizer()" title="Order More Fertilizer">Order Fertilizer</span>
                            <span class="btn" onclick="orderSeeds()" title="Order More Seeds">Order Seeds</span>
                            <span class="btn" onclick="manageInventory()" title="Manage Full Inventory">Manage Inventory</span>
                            <span class="btn" onclick="optimizeResourceUse()" title="Optimize Resource Usage">Optimize Usage</span>
                        </div>
                    </div>
                    <div class="sensor-grid">
                        <div class="sensor-card" onclick="viewInventory()">
                            <div class="sensor-header">
                                <i class="fas fa-box sensor-icon"></i>
                                <span class="sensor-title">Fertilizer Stock</span>
                            </div>
                            <div class="sensor-data">
                                <div>Current: <span id="fertilizerStockFull">500 kg</span></div>
                                <div>Weekly Use: <span id="fertilizerUse">50 kg</span></div>
                                <div>Reorder At: 100 kg</div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 90%;" title="Fertilizer Stock"></div></div>
                        </div>
                        <div class="sensor-card" onclick="viewInventory()">
                            <div class="sensor-header">
                                <i class="fas fa-tint sensor-icon"></i>
                                <span class="sensor-title">Water Reserves</span>
                            </div>
                            <div class="sensor-data">
                                <div>Current: <span id="waterStockFull">1000 gal</span></div>
                                <div>Daily Use: <span id="waterUseFull">500 gal</span></div>
                                <div>Capacity: 2000 gal</div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 50%;" title="Water Reserves"></div></div>
                        </div>
                        <div class="sensor-card" onclick="viewInventory()">
                            <div class="sensor-header">
                                <i class="fas fa-seedling sensor-icon"></i>
                                <span class="sensor-title">Seed Inventory</span>
                            </div>
                            <div class="sensor-data">
                                <div>Current: <span id="seedStockFull">200 kg</span></div>
                                <div>Needed Next Planting: 150 kg</div>
                                <div>Reorder At: 50 kg</div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 80%;" title="Seed Inventory"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Equipment Operations Center -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-tractor"></i>
                            Equipment Operations Center
                        </h2>
                        <div class="action-buttons">
                            <span class="btn" onclick="checkEquipment()" title="Check Equipment Status">Check Status</span>
                            <span class="btn" onclick="scheduleEquipmentMaintenance()" title="Schedule Equipment Maintenance">Schedule Maintenance</span>
                            <span class="btn" onclick="viewEquipmentLogs()" title="View Equipment Logs">View Logs</span>
                        </div>
                    </div>
                    <div class="sensor-grid">
                        <div class="sensor-card" onclick="checkEquipment()">
                            <div class="sensor-header">
                                <i class="fas fa-tractor sensor-icon"></i>
                                <span class="sensor-title">Tractors</span>
                                <span class="status-indicator active" title="Operational"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Units: 2</div>
                                <div>Hours Used: <span id="tractorHours">150</span></div>
                                <div>Maintenance Due: <span id="tractorMaintenance">2024-01-15</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 75%;" title="Operational Status"></div></div>
                        </div>
                        <div class="sensor-card" onclick="checkEquipment()">
                            <div class="sensor-header">
                                <i class="fas fa-spray-can sensor-icon"></i>
                                <span class="sensor-title">Irrigators</span>
                                <span class="status-indicator active" title="Operational"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Units: 1</div>
                                <div>Hours Used: <span id="irrigatorHours">80</span></div>
                                <div>Maintenance Due: <span id="irrigatorMaintenance">2024-02-01</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 80%;" title="Operational Status"></div></div>
                        </div>
                        <div class="sensor-card" onclick="checkEquipment()">
                            <div class="sensor-header">
                                <i class="fas fa-tools sensor-icon"></i>
                                <span class="sensor-title">Harvesters</span>
                                <span class="status-indicator active" title="Operational"></span>
                            </div>
                            <div class="sensor-data">
                                <div>Units: 1</div>
                                <div>Hours Used: <span id="harvesterHours">60</span></div>
                                <div>Maintenance Due: <span id="harvesterMaintenance">2024-03-01</span></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 85%;" title="Operational Status"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Sensors View -->
                <div class="view sensors-view">
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-microchip"></i>
                                Sensor Command Network
                            </h2>
                            <div class="action-buttons">
                                <span class="btn btn-primary" onclick="switchView('add-sensor')" title="Deploy New Sensor">
                                    <i class="fas fa-plus"></i> Add Sensor
                                </span>
                                <span class="btn" onclick="toggleAllSensors()" title="Expand/Collapse All Sensors">Expand All</span>
                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                <span class="btn" onclick="syncSensors()" title="Sync All Sensor Data">Sync Data</span>
                                <span class="btn" onclick="resetSensors()" title="Reset All Sensors">Reset All</span>
                                <span class="btn" onclick="exportSensorData()" title="Export Sensor Data">Export Data</span>
                            </div>
                        </div>
                        <div class="sensor-grid" id="fullSensorGrid">
                            <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 1')">
                                <div class="sensor-header">
                                    <i class="fas fa-microchip sensor-icon"></i>
                                    <span class="sensor-title">Sensor 1</span>
                                    <span class="status-indicator active" title="Sensor Active"></span>
                                </div>
                                <div class="sensor-data">
                                    <div>Temp: <span id="temp1Full">72°F</span></div>
                                    <div>Humidity: <span id="humid1Full">65%</span></div>
                                    <div>Light: <span id="light1Full">14 Dli</span></div>
                                    <div>pH: <span id="ph1Full">7.5</span></div>
                                    <div>Battery: <span id="battery1Full">95%</span></div>
                                </div>
                                <div class="sensor-details">
                                    <div>Status: Active<span class="status-indicator active"></span></div>
                                    <div>Location: Corn Field A, Row 1</div>
                                    <div>Crop Monitored: Corn</div>
                                    <div>Last Calibration: 2023-11-25</div>
                                    <div>Installation Date: 2023-01-15</div>
                                    <div>Sensor ID: FS-001</div>
                                    <div>Last Reading: <span id="lastReading1Full"></span></div>
                                    <div>Signal Strength: 92%</div>
                                    <div>Power Source: Solar + Battery</div>
                                    <div>Firmware Version: 2.1.3</div>
                                    <div>Operating Temp Range: 32°F - 120°F</div>
                                    <div>Accuracy: ±0.5°F, ±2% RH</div>
                                    <div>Maintenance Due: 2024-01-15</div>
                                    <div class="crop-info">
                                        <div>Crop Type: Corn</div>
                                        <div>Variety: Golden Hybrid</div>
                                        <div>Health: Good</div>
                                        <div>Water Need: Moderate</div>
                                        <div>Growth Stage: Flowering</div>
                                        <div>Last Irrigation: 2023-11-27</div>
                                        <div>Last Fertilized: 2023-11-20</div>
                                    </div>
                                    <div class="progress-bar"><div class="progress-fill" style="width: 95%;" title="Battery Level"></div></div>
                                    <div class="chart-container" style="height: 320px;">
                                        <canvas id="sensorChart1Full"></canvas>
                                    </div>
                                    <div class="action-buttons">
                                        <span class="btn info" onclick="calibrateSensor('Sensor 1')" title="Calibrate This Sensor">Calibrate</span>
                                        <span class="btn danger" onclick="deactivateSensor('Sensor 1')" title="Deactivate This Sensor">Deactivate</span>
                                        <span class="btn" onclick="viewSensorLogs('Sensor 1')" title="View Sensor Logs">View Logs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 2')">
                                <div class="sensor-header">
                                    <i class="fas fa-microchip sensor-icon"></i>
                                    <span class="sensor-title">Sensor 2</span>
                                    <span class="status-indicator active" title="Sensor Active"></span>
                                </div>
                                <div class="sensor-data">
                                    <div>Temp: <span id="temp2Full">71°F</span></div>
                                    <div>Humidity: <span id="humid2Full">64%</span></div>
                                    <div>Light: <span id="light2Full">13.8 Dli</span></div>
                                    <div>pH: <span id="ph2Full">7.4</span></div>
                                    <div>Battery: <span id="battery2Full">88%</span></div>
                                </div>
                                <div class="sensor-details">
                                    <div>Status: Active<span class="status-indicator active"></span></div>
                                    <div>Location: Corn Field A, Row 2</div>
                                    <div>Crop Monitored: Corn</div>
                                    <div>Last Calibration: 2023-11-24</div>
                                    <div>Installation Date: 2023-01-16</div>
                                    <div>Sensor ID: FS-002</div>
                                    <div>Last Reading: <span id="lastReading2Full"></span></div>
                                    <div>Signal Strength: 88%</div>
                                    <div>Power Source: Battery</div>
                                    <div>Firmware Version: 2.1.2</div>
                                    <div>Operating Temp Range: 32°F - 120°F</div>
                                    <div>Accuracy: ±0.5°F, ±2% RH</div>
                                    <div>Maintenance Due: 2024-01-16</div>
                                    <div class="crop-info">
                                        <div>Crop Type: Corn</div>
                                        <div>Variety: Golden Hybrid</div>
                                        <div>Health: Good</div>
                                        <div>Water Need: Moderate</div>
                                        <div>Growth Stage: Flowering</div>
                                        <div>Last Irrigation: 2023-11-27</div>
                                        <div>Last Fertilized: 2023-11-20</div>
                                    </div>
                                    <div class="progress-bar"><div class="progress-fill" style="width: 88%;" title="Battery Level"></div></div>
                                    <div class="chart-container" style="height: 320px;">
                                        <canvas id="sensorChart2Full"></canvas>
                                    </div>
                                    <div class="action-buttons">
                                        <span class="btn info" onclick="calibrateSensor('Sensor 2')" title="Calibrate This Sensor">Calibrate</span>
                                        <span class="btn danger" onclick="deactivateSensor('Sensor 2')" title="Deactivate This Sensor">Deactivate</span>
                                        <span class="btn" onclick="viewSensorLogs('Sensor 2')" title="View Sensor Logs">View Logs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 3')">
                                <div class="sensor-header">
                                    <i class="fas fa-microchip sensor-icon"></i>
                                    <span class="sensor-title">Sensor 3</span>
                                    <span class="status-indicator active" title="Sensor Active"></span>
                                </div>
                                <div class="sensor-data">
                                    <div>Temp: <span id="temp3Full">73°F</span></div>
                                    <div>Humidity: <span id="humid3Full">66%</span></div>
                                    <div>Light: <span id="light3Full">14.2 Dli</span></div>
                                    <div>pH: <span id="ph3Full">7.6</span></div>
                                    <div>Battery: <span id="battery3Full">92%</span></div>
                                </div>
                                <div class="sensor-details">
                                    <div>Status: Active<span class="status-indicator active"></span></div>
                                    <div>Location: Wheat Field B, Row 1</div>
                                    <div>Crop Monitored: Wheat</div>
                                    <div>Last Calibration: 2023-11-23</div>
                                    <div>Installation Date: 2023-01-17</div>
                                    <div>Sensor ID: FS-003</div>
                                    <div>Last Reading: <span id="lastReading3Full"></span></div>
                                    <div>Signal Strength: 90%</div>
                                    <div>Power Source: Solar</div>
                                    <div>Firmware Version: 2.1.3</div>
                                    <div>Operating Temp Range: 32°F - 120°F</div>
                                    <div>Accuracy: ±0.5°F, ±2% RH</div>
                                    <div>Maintenance Due: 2024-01-17</div>
                                    <div class="crop-info">
                                        <div>Crop Type: Wheat</div>
                                        <div>Variety: Winter Red</div>
                                        <div>Health: Excellent</div>
                                        <div>Water Need: Low</div>
                                        <div>Growth Stage: Grain Fill</div>
                                        <div>Last Irrigation: 2023-11-26</div>
                                        <div>Last Fertilized: 2023-11-19</div>
                                    </div>
                                    <div class="progress-bar"><div class="progress-fill" style="width: 92%;" title="Battery Level"></div></div>
                                    <div class="chart-container" style="height: 320px;">
                                        <canvas id="sensorChart3Full"></canvas>
                                    </div>
                                    <div class="action-buttons">
                                        <span class="btn info" onclick="calibrateSensor('Sensor 3')" title="Calibrate This Sensor">Calibrate</span>
                                        <span class="btn danger" onclick="deactivateSensor('Sensor 3')" title="Deactivate This Sensor">Deactivate</span>
                                        <span class="btn" onclick="viewSensorLogs('Sensor 3')" title="View Sensor Logs">View Logs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="sensor-card" onclick="toggleSensor(this, 'Sensor 4')">
                                <div class="sensor-header">
                                    <i class="fas fa-microchip sensor-icon"></i>
                                    <span class="sensor-title">Sensor 4</span>
                                    <span class="status-indicator active" title="Sensor Active"></span>
                                </div>
                                <div class="sensor-data">
                                    <div>Temp: <span id="temp4Full">70°F</span></div>
                                    <div>Humidity: <span id="humid4Full">63%</span></div>
                                    <div>Light: <span id="light4Full">13.5 Dli</span></div>
                                    <div>Moisture: <span id="moisture4Full">42%</span></div>
                                    <div>pH: <span id="ph4Full">7.6</span></div>
                                    <div>Location: Wheat Field B, Row 8</div>
                                    <div>Crop Type: Wheat</div>
                                    <div>Crop Stage: <span id="stage4">Grain Fill</span></div>
                                    <div>Planting Date: <span id="planting4">2023-04-15</span></div>
                                    <div>Expected Harvest: <span id="harvest4">2023-09-25</span></div>
                                    <div>Yield Prediction: <span id="yield4">82%</span></div>
                                    <div>pH: <span id="ph4Full">7.3</span></div>
                                    <div>Battery: <span id="battery4Full">90%</span></div>
                                </div>
                                <div class="sensor-details">
                                    <div>Status: Active<span class="status-indicator active"></span></div>
                                    <div>Location: Wheat Field B, Row 2</div>
                                    <div>Crop Monitored: Wheat</div>
                                    <div>Last Calibration: 2023-11-22</div>
                                    <div>Installation Date: 2023-01-18</div>
                                    <div>Sensor ID: FS-004</div>
                                    <div>Last Reading: <span id="lastReading4Full"></span></div>
                                    <div>Signal Strength: 89%</div>
                                    <div>Power Source: Battery</div>
                                    <div>Firmware Version: 2.1.2</div>
                                    <div>Operating Temp Range: 32°F - 120°F</div>
                                    <div>Accuracy: ±0.5°F, ±2% RH</div>
                                    <div>Maintenance Due: 2024-01-18</div>
                                    <div class="crop-info">
                                        <div>Crop Type: Wheat</div>
                                        <div>Variety: Winter Red</div>
                                        <div>Health: Excellent</div>
                                        <div>Water Need: Low</div>
                                        <div>Growth Stage: Grain Fill</div>
                                        <div>Last Irrigation: 2023-11-26</div>
                                        <div>Last Fertilized: 2023-11-19</div>
                                    </div>
                                    <div class="progress-bar"><div class="progress-fill" style="width: 90%;" title="Battery Level"></div></div>
                                    <div class="chart-container" style="height: 320px;">
                                        <canvas id="sensorChart4Full"></canvas>
                                    </div>
                                    <div class="action-buttons">
                                        <span class="btn info" onclick="calibrateSensor('Sensor 4')" title="Calibrate This Sensor">Calibrate</span>
                                        <span class="btn danger" onclick="deactivateSensor('Sensor 4')" title="Deactivate This Sensor">Deactivate</span>
                                        <span class="btn" onclick="viewSensorLogs('Sensor 4')" title="View Sensor Logs">View Logs</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" style="height: 360px; margin-top: 45px;">
                            <canvas id="sensorNetworkChartFull"></canvas>
                        </div>
                    </div>
                </div>

                                <!-- Analytics View -->
                                <div class="view analytics-view">
                                <div class="section">
                                <div class="section-header">
                                <h2 class="section-title">
                                <i class="fas fa-chart-line"></i>
                                Advanced Farm Analytics
                                </h2>
                                <div class="action-buttons">
                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                <span class="btn" onclick="downloadAnalytics()" title="Download Analytics Report">Download Report</span>
                                <span class="btn" onclick="compareSeasons()" title="Compare with Previous Seasons">Compare Seasons</span>
                                <span class="btn" onclick="setAnalyticsGoals()" title="Set Analytics Goals">Set Goals</span>
                                </div>
                                </div>
                                <div class="sensor-grid">
                                <div class="sensor-card" onclick="showAnalytics('temperature')">
                                <div class="sensor-header">
                                <i class="fas fa-thermometer-half sensor-icon"></i>
                                <span class="sensor-title">Temperature Trends</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendTemp">72°F</span></div>
                                <div>Min: <span id="minTemp">68°F</span></div>
                                <div>Max: <span id="maxTemp">75°F</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 72%;" title="Temperature Range"></div></div>
                                </div>
                                <div class="sensor-card" onclick="showAnalytics('humidity')">
                                <div class="sensor-header">
                                <i class="fas fa-tint sensor-icon"></i>
                                <span class="sensor-title">Humidity Trends</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendHumid">65%</span></div>
                                <div>Min: <span id="minHumid">62%</span></div>
                                <div>Max: <span id="maxHumid">68%</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 65%;" title="Humidity Range"></div></div>
                                </div>
                                <div class="sensor-card" onclick="showAnalytics('light')">
                                <div class="sensor-header">
                                <i class="fas fa-sun sensor-icon"></i>
                                <span class="sensor-title">Light Trends</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendLight">14 Dli</span></div>
                                <div>Min: <span id="minLight">13 Dli</span></div>
                                <div>Max: <span id="maxLight">15 Dli</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 70%;" title="Light Range"></div></div>
                                </div>
                                <div class="sensor-card" onclick="showAnalytics('ph')">
                                <div class="sensor-header">
                                <i class="fas fa-flask sensor-icon"></i>
                                <span class="sensor-title">pH Trends</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendPh">7.5</span></div>
                                <div>Min: <span id="minPh">7.3</span></div>
                                <div>Max: <span id="maxPh">7.6</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 75%;" title="pH Range"></div></div>
                                </div>
                                <div class="sensor-card" onclick="showAnalytics('yield')">
                                <div class="sensor-header">
                                <i class="fas fa-leaf sensor-icon"></i>
                                <span class="sensor-title">Yield Forecast</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendYield">87%</span></div>
                                <div>Corn: <span id="trendCornYield">85%</span></div>
                                <div>Wheat: <span id="trendWheatYield">90%</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 87%;" title="Yield Potential"></div></div>
                                </div>
                                <div class="sensor-card" onclick="showAnalytics('battery')">
                                <div class="sensor-header">
                                <i class="fas fa-battery-full sensor-icon"></i>
                                <span class="sensor-title">Battery Trends</span>
                                </div>
                                <div class="sensor-data">
                                <div>Avg: <span id="trendBattery">90%</span></div>
                                <div>Min: <span id="minBattery">88%</span></div>
                                <div>Max: <span id="maxBattery">95%</span></div>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 90%;" title="Battery Levels"></div></div>
                                </div>
                                </div>
                                <div class="chart-container" style="height: 480px;">
                                <canvas id="analyticsChart"></canvas>
                                </div>
                                </div>
                                </div>

                                <!-- Notifications View -->
                                <div class="view notifications-view">
                                <div class="section">
                                <div class="section-header">
                                <h2 class="section-title">
                                <i class="fas fa-bell"></i>
                                Alert Command Center
                                </h2>
                                <div class="action-buttons">
                                <span class="btn" onclick="clearNotifications()" title="Clear All Alerts">Clear All</span>
                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                <span class="btn" onclick="archiveAlerts()" title="Archive Old Alerts">Archive</span>
                                <span class="btn" onclick="setAlertRules()" title="Set Alert Rules">Set Rules</span>
                                </div>
                                </div>
                                <div class="notification-list" id="notificationList">
                                <div class="notification-item warning">
                                <div class="notification-icon warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="notification-content">
                                <div class="notification-title">Low Battery Warning</div>
                                <div class="notification-text">Sensor 2 battery at 88%</div>
                                <div class="notification-time">5 minutes ago</div>
                                </div>
                                </div>
                                </div>
                                <div class="chart-container" style="height: 360px; margin-top: 45px;">
                                <canvas id="alertTrendChart"></canvas>
                                </div>
                                </div>
                                </div>

                                <!-- Account View -->
                                <div class="view account-view">
                                <div class="section">
                                <div class="section-header">
                                <h2 class="section-title">
                                <i class="fas fa-user"></i>
                                Account Operations Dashboard
                                </h2>
                                <div class="action-buttons">
                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                <span class="btn" onclick="upgradePlan()" title="Upgrade Subscription Plan">Upgrade Plan</span>
                                <span class="btn" onclick="manageUsers()" title="Manage Farm Users">Manage Users</span>
                                <span class="btn" onclick="exportAccountData()" title="Export Account Data">Export Data</span>
                                </div>
                                </div>
                                <div class="account-info">
                                <div class="info-item">
                                <label>User Name:</label>
                                <span>Farmer John Doe</span>
                                </div>
                                <div class="info-item">
                                <label>Email:</label>
                                <span>john.doe@farm.com</span>
                                </div>
                                <div class="info-item">
                                <label>Plan:</label>
                                <span>Professional Elite</span>
                                </div>
                                <div class="info-item">
                                <label>Next Payment:</label>
                                <span>March 31, 2025</span>
                                </div>
                                <div class="info-item">
                                <label>Active Sensors:</label>
                                <span>4/20</span>
                                <div class="progress-bar"><div class="progress-fill" style="width: 20%;" title="Sensor Usage"></div></div>
                                </div>
                                <div class="info-item">
                                <label>Data Storage:</label>
                                <span>1.2GB/5GB Used</span>
                                <div class="progress-bar"><div class="progress-fill" style="width: 24%;" title="Storage Usage"></div></div>
                                </div>
                                <div class="info-item">
                                <label>Support Level:</label>
                                <span>Priority 24/7</span>
                                </div>
                                <div class="info-item">
                                <label>Farm Size:</label>
                                <span>150 Acres</span>
                                </div>
                                <div class="info-item">
                                <label>Registered Users:</label>
                                <span>3</span>
                                </div>
                                <div class="info-item">
                                <label>Account Created:</label>
                                <span>2023-01-01</span>
                                </div>
                                </div>
                                <div class="chart-container" style="height: 340px; margin-top: 45px;">
                                <canvas id="accountUsageChart"></canvas>
                                </div>
                                </div>
                                </div>

                                <!-- Weather View -->
                                <div class="view weather-view">
                                <div class="section">
                                <div class="section-header">
                                <h2 class="section-title">
                                <i class="fas fa-cloud-sun"></i>
                                Weather Operations Hub
                                </h2>
                                <div class="action-buttons">
                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                <span class="btn" onclick="updateWeatherAlerts()" title="Refresh Weather Alerts">Update Alerts</span>
                                <span class="btn" onclick="adjustIrrigation()" title="Adjust Irrigation Based on Forecast">Adjust Irrigation</span>
                                <span class="btn" onclick="downloadWeatherData()" title="Download Weather Data">Download Data</span>
                                <span class="btn" onclick="setWeatherThresholds()" title="Set Weather Thresholds">Set Thresholds</span>
                                </div>
                                </div>
                                <div class="weather-card">
                                <div class="weather-animation">
                                <div class="cloud" style="top: 35px; animation-delay: 0s;"></div>
                                <div class="cloud" style="top: 90px; animation-delay: 2s;"></div>
                                <div class="cloud" style="top: 145px; animation-delay: 4s;"></div>
                                <div class="cloud" style="top: 200px; animation-delay: 6s;"></div>
                                <div class="cloud" style="top: 255px; animation-delay: 8s;"></div>
                                <div class="cloud" style="top: 310px; animation-delay: 10s;"></div>
                                </div>
                                <div class="weather-info">
                                <div>
                                <div class="weather-temp" id="detailedWeatherTemp">72°F</div>
                                <div class="weather-desc" id="detailedWeatherDesc">Partly Cloudy</div>
                                </div>
                                <i class="fas fa-cloud-sun fa-3x"></i>
                                </div>
                                <div class="sensor-data" style="margin-top: 40px;">
                                <div>Humidity: <span id="detailedWeatherHumid">65%</span></div>
                                <div>Wind Speed: 8 mph</div>
                                <div>Wind Direction: NW</div>
                                <div>Precipitation: 10% Chance</div>
                                <div>UV Index: 6</div>
                                <div>Temperature High: 75°F</div>
                                <div>Temperature Low: 68°F</div>
                                <div>Pressure: 1013 hPa</div>
                                <div>Visibility: 10 miles</div>
                                <div>Sunrise: 6:45 AM</div>
                                <div>Sunset: 7:30 PM</div>
                                <div>Dew Point: 62°F</div>
                                </div>
                                <div class="chart-container" style="height: 320px; margin-top: 40px;">
                                <canvas id="weatherChart"></canvas>
                                </div>
                                <div class="action-buttons" style="margin-top: 40px;">
                                <span class="btn" onclick="viewHourlyForecast()" title="View Hourly Weather Forecast">Hourly Forecast</span>
                                <span class="btn" onclick="viewWeeklyForecast()" title="View Weekly Weather Forecast">Weekly Forecast</span>
                                <span class="btn" onclick="viewWeatherHistory()" title="View Weather History">Weather History</span>
                                </div>
                                </div>
                                </div>
                                </div>

                                <!-- Add Sensor View -->
                                <div class="view add-sensor-view">
                                <div class="section">
                                <div class="section-header">
                                <h2 class="section-title">
                                <i class="fas fa-plus"></i>
                                Deploy New Sensor
                                </h2>
                                <div class="action-buttons">
                                <span class="btn" onclick="switchView('sensors')" title="Return to Sensors View">Back to Sensors</span>
                                <span class="btn" onclick="autoDetectSensors()" title="Auto-Detect Available Sensors">Auto-Detect</span>
                                <span class="btn" onclick="bulkAddSensors()" title="Add Multiple Sensors">Bulk Add</span>
                                </div>
                                </div>
                                <form id="addSensorForm">
                                <div class="form-group">
                                <label for="sensorId">Sensor ID:</label>
                                <input type="text" id="sensorId" name="sensorId" placeholder="e.g., FS-005" required>
                                </div>
                                <div class="form-group">
                                <label for="location">Location:</label>
                                <input type="text" id="location" name="location" placeholder="e.g., Corn Field A, Row 3" required>
                                </div>
                                <div class="form-group">
                                <label for="cropType">Crop Monitored:</label>
                                <select id="cropType" name="cropType" required>
                                <option value="Corn">Corn</option>
                                <option value="Wheat">Wheat</option>
                                <option value="Soybeans">Soybeans</option>
                                </select>
                                </div>
                                <div class="form-group">
                                <label for="installDate">Installation Date:</label>
                                <input type="date" id="installDate" name="installDate" required>
                                </div>
                                <div class="form-group">
                                <label for="powerSource">Power Source:</label>
                                <select id="powerSource" name="powerSource" required>
                                <option value="Battery">Battery</option>
                                <option value="Solar">Solar</option>
                                <option value="Solar + Battery">Solar + Battery</option>
                                </select>
                                </div>
                                <div class="form-group">
                                <label for="notes">Notes:</label>
                                <input type="text" id="notes" name="notes" placeholder="e.g., Near irrigation line">
                                </div>
                                <button type="submit" class="btn btn-primary" title="Deploy This Sensor">Deploy Sensor</button>
                                </form>
                                </div>
                                </div>

                                <!-- Settings View -->
                                <div class="view settings-view">
                                    <div class="section">
                                        <div class="section-header">
                                            <h2 class="section-title">
                                                <i class="fas fa-cog"></i>
                                                Control Center Settings
                                            </h2>
                                            <div class="action-buttons">
                                                <span class="btn" onclick="switchView('home')" title="Return to Dashboard">Back to Dashboard</span>
                                                <span class="btn" onclick="saveSettings()" title="Save All Settings">Save Settings</span>
                                                <span class="btn" onclick="resetSettings()" title="Reset to Default Settings">Reset Settings</span>
                                            </div>
                                        </div>
                                        <div class="settings-panel">
                                            <div class="settings-option">
                                                <label>Theme:</label>
                                                <select id="themeSelect" onchange="changeTheme()">
                                                    <option value="light">Light</option>
                                                    <option value="dark">Dark</option>
                                                    <option value="nature">Nature</option>
                                                    <option value="custom">Custom</option>
                                                </select>
                                            </div>
                                            <div class="settings-option">
                                                <label>Update Frequency:</label>
                                                <select id="updateFreq" onchange="setUpdateFrequency()">
                                                    <option value="2000">2 Seconds</option>
                                                    <option value="5000">5 Seconds</option>
                                                    <option value="10000">10 Seconds</option>
                                                    <option value="30000">30 Seconds</option>
                                                </select>
                                            </div>
                                <div class="settings-option">
                                <label>Notifications:</label>
                                <input type="checkbox" id="notifyToggle" checked> Enable
                                </div>
                                <div class="settings-option">
                                <label>Units:</label>
                                <select id="unitSelect" onchange="updateUnits()">
                                <option value="imperial">Imperial (°F, mph)</option>
                                <option value="metric">Metric (°C, km/h)</option>
                                </select>
                                </div>
                                <div class="settings-option">
                                <label>Language:</label>
                                <select id="languageSelect" onchange="updateLanguage()">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                </select>
                                </div>
                                <div class="settings-option">
                                <label>Alert Thresholds:</label>
                                <input type="number" id="tempThreshold" value="80" placeholder="Max Temp (°F)" style="width: 120px;">
                                <input type="number" id="humidThreshold" value="60" placeholder="Min Humidity (%)" style="width: 120px;">
                                </div>
                                <div class="settings-option">
                                <label>Data Retention:</label>
                                <select id="dataRetention">
                                <option value="30">30 Days</option>
                                <option value="90">90 Days</option>
                                <option value="365">1 Year</option>
                                <option value="unlimited">Unlimited</option>
                                </select>
                                </div>
                                <div class="settings-option">
                                <label>Auto-Sync:</label>
                                <input type="checkbox" id="autoSync" checked> Enable
                                </div>
                                </div>
                                </div>
                        </div>
                    </div>
                </div>

                <div class="nav-bar">
                    <a href="index.html" class="nav-item" title="Farm Dashboard">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="sensors.html" class="nav-item" title="Sensor Management">
                        <i class="fas fa-microchip"></i>
                        <span>Sensors</span>
                    </a>
                    <a href="weather.html" class="nav-item" title="Weather Command Station">
                        <i class="fas fa-cloud-sun"></i>
                        <span>Weather</span>
                    </a>
                    <a href="analytics.html" class="nav-item" title="Data Analytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="alerts.html" class="nav-item" title="Alert Command Center">
                        <i class="fas fa-bell"></i>
                        <span>Alerts</span>
                    </a>
                    <a href="settings.html" class="nav-item" title="System Settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </div>

            <script>
            // Initialize navigation when the page loads
            document.addEventListener('DOMContentLoaded', function() {
                console.log("Initializing AgriSense Pro 3 dashboard...");
                
                // Highlight the active page in the navigation bar
                const currentPage = window.location.pathname.split('/').pop() || 'index.html';
                const navItems = document.querySelectorAll('.nav-bar .nav-item');
                
                navItems.forEach(item => {
                    const href = item.getAttribute('href');
                    if (href === currentPage) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Fix navigation bar styling
                const navBar = document.querySelector('.nav-bar');
                if (navBar) {
                    navBar.style.position = 'fixed';
                    navBar.style.bottom = '20px';
                    navBar.style.left = '50%';
                    navBar.style.transform = 'translateX(-50%)';
                    navBar.style.zIndex = '9999';
                    navBar.style.width = '90%';
                    navBar.style.maxWidth = '600px';
                }
                
                console.log("Initialization complete");
            });
            
            // Fix navigation click handling
            function fixNavigation() {
                const navItems = document.querySelectorAll('.nav-bar .nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Get the href attribute to determine which page to go to
                        const href = this.getAttribute('href');
                        if (href) {
                            // For SPA navigation within this page
                            if (href.includes('.html')) {
                                // Remove 'active' class from all nav items
                                navItems.forEach(navItem => navItem.classList.remove('active'));
                                // Add 'active' class to the clicked nav item
                                this.classList.add('active');
                                
                                // Navigate to the page
                                window.location.href = href;
                            }
                        }
                        
                        return false;
                    });
                });
                
                console.log("Navigation links fixed and ready");
            }
            
            // Initialize views and navigation when the page loads
            document.addEventListener('DOMContentLoaded', function() {
                // Fix navigation
                fixNavigation();
                console.log("Initializing AgriSense Pro 3 dashboard...");
                
                // Set up initial views - hide all except home
                const views = ['home', 'sensors', 'analytics', 'notifications', 'account', 'weather', 'add-sensor', 'settings'];
                views.forEach(view => {
                    const viewElement = document.querySelector(`.${view}-view`);
                    if (viewElement) {
                        viewElement.style.display = 'none';
                        viewElement.classList.remove('active');
                        if (view === 'home') {
                            viewElement.style.display = 'block';
                            viewElement.classList.add('active');
                        }
                    } else {
                        console.warn(`View element .${view}-view not found`);
                    }
                });
                
                // Set up click handlers for navigation items
                document.querySelectorAll('.nav-item').forEach(navItem => {
                    navItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Get the view name from the onclick attribute
                        const viewName = this.getAttribute('onclick').split("'")[1];
                        console.log("Navigation clicked:", viewName);
                        
                        // Switch to the selected view
                        switchView(viewName);
                        
                        // Update active state in navigation
                        document.querySelectorAll('.nav-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        return false;
                    });
                });
                
                // Set up click handlers for header icons
                document.querySelectorAll('.header-icon').forEach(icon => {
                    icon.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Extract view name from onclick attribute
                        const onclickAttr = this.getAttribute('onclick');
                        if (onclickAttr && onclickAttr.includes("switchView('")) {
                            const viewName = onclickAttr.split("switchView('")[1].split("')")[0];
                            switchView(viewName);
                        }
                        
                        return false;
                    });
                });
                
                // Initialize timestamp for sensor readings
                try {
                    if (typeof sensorData !== 'undefined' && sensorData.sensors) {
                        sensorData.sensors.forEach((_, index) => {
                            const timeElement = document.getElementById(`lastReading${index + 1}Full`);
                            if (timeElement) {
                                timeElement.textContent = new Date().toLocaleString();
                            }
                        });
                    }
                } catch (e) {
                    console.error("Error initializing sensor timestamps:", e);
                }
                
                // Initialize charts with a delay to ensure DOM is ready
                setTimeout(function() {
                    try {
                        if (typeof updateAllCharts === 'function') {
                            updateAllCharts();
                        }
                    } catch (e) {
                        console.error("Error initializing charts:", e);
                    }
                }, 500);
                
                // Make sure home is highlighted initially
                updateNavHighlight('home');
                
                // Fix navigation bar styling
                fixNavBarStyling();
                
                console.log("Initialization complete");
            });
            
            // Function to switch between views
            function switchView(view) {
                console.log(`Switching to view: ${view}`);
                
                // Get all views
                const views = document.querySelectorAll('.view');
                
                // Hide all views first
                views.forEach(viewElement => {
                    viewElement.classList.remove('active');
                    viewElement.style.display = 'none';
                });
                
                // Show the selected view
                const selectedView = document.querySelector(`.${view}-view`);
                if (selectedView) {
                    selectedView.classList.add('active');
                    selectedView.style.display = 'block';
                    console.log(`View ${view} activated`);
                    
                    // Update navigation highlighting
                    updateNavHighlight(view);
                    
                    // Make sure sensor data is initialized before using it
                    if (typeof sensorData === 'undefined') {
                        window.sensorData = {
                            sensors: [
                                { id: 'Sensor 1', temp: 72, humid: 65, light: 14, ph: 7.5, battery: 95, crop: 'Corn', location: 'Corn Field A, Row 1', status: 'Active' },
                                { id: 'Sensor 2', temp: 71, humid: 64, light: 13.8, ph: 7.4, battery: 88, crop: 'Corn', location: 'Corn Field A, Row 2', status: 'Active' },
                                { id: 'Sensor 3', temp: 73, humid: 66, light: 14.2, ph: 7.6, battery: 92, crop: 'Wheat', location: 'Wheat Field B, Row 1', status: 'Active' },
                                { id: 'Sensor 4', temp: 70, humid: 63, light: 13.5, ph: 7.3, battery: 90, crop: 'Wheat', location: 'Wheat Field B, Row 2', status: 'Active' }
                            ],
                            weather: { temp: 72, humid: 65, wind: 8, precip: 10 },
                            crops: {
                                'Corn': { health: 'Good', water: 'Moderate', moisture: 65, temp: 72, light: 14, ph: 7.5, planting: '2023-04-15', harvest: '2023-09-30', stage: 'Flowering', yield: 85 },
                                'Wheat': { health: 'Excellent', water: 'Low', moisture: 63, temp: 71, light: 13.8, ph: 7.4, planting: '2023-03-20', harvest: '2023-08-15', stage: 'Grain Fill', yield: 90 },
                                'Soybeans': { health: 'Good', water: 'Moderate', moisture: 66, temp: 73, light: 14.5, ph: 7.6, planting: '2023-05-01', harvest: '2023-10-10', stage: 'Pod Setting', yield: 82 }
                            },
                            tasks: [],
                            logs: []
                        };
                    }
                    
                    // Handle specific views with their data updates
                    if (view === 'sensors') {
                        updateSensorViewData();
                    } 
                    else if (view === 'analytics') {
                        setTimeout(() => updateAnalyticsChart('temperature'), 100);
                    }
                    else if (view === 'weather') {
                        setTimeout(() => updateWeatherChart(), 100);
                    }
                    else if (view === 'notifications') {
                        if (typeof notifications === 'undefined') {
                            window.notifications = [
                                { title: "Low Battery Warning", text: "Sensor 2 battery at 88%", time: "5 minutes ago", type: "warning" }
                            ];
                        }
                        setTimeout(() => updateAlertTrendChart(), 100);
                    }
                    else if (view === 'account') {
                        setTimeout(() => updateAccountUsageChart(), 100);
                    }
                    
                    // Scroll to top of content area
                    const contentArea = document.querySelector('.content');
                    if (contentArea) {
                        contentArea.scrollTop = 0;
                    }
                    
                    // Update all charts after a short delay to ensure DOM is ready
                    setTimeout(function() {
                        if (typeof updateAllCharts === 'function') {
                            updateAllCharts();
                        }
                    }, 300);
                } else {
                    console.error(`View ${view} not found`);
                    // Default to home if view not found
                    const homeView = document.querySelector('.home-view');
                    if (homeView) {
                        homeView.classList.add('active');
                        homeView.style.display = 'block';
                        updateNavHighlight('home');
                    }
                }
                
                // Always fix the navigation bar styling after switching views
                fixNavBarStyling();
            }
            
            // Function to update sensor view data
            function updateSensorViewData() {
                if (typeof sensorData !== 'undefined' && sensorData.sensors) {
                    sensorData.sensors.forEach((sensor, index) => {
                        // Update all sensor data fields
                        const updateElement = function(id, value) {
                            const element = document.getElementById(id);
                            if (element) element.textContent = value;
                        };
                        
                        const tempUnit = 'F'; // Default to imperial
                        
                        // Update sensor card data
                        updateElement(`temp${index + 1}Full`, `${sensor.temp}°${tempUnit}`);
                        updateElement(`humid${index + 1}Full`, `${sensor.humid}%`);
                        updateElement(`light${index + 1}Full`, `${sensor.light} Dli`);
                        updateElement(`ph${index + 1}Full`, sensor.ph);
                        updateElement(`battery${index + 1}Full`, `${sensor.battery}%`);
                        
                        // Update timestamps
                        const currentTime = new Date().toLocaleString();
                        updateElement(`lastReading${index + 1}Full`, currentTime);
                        
                        // Ensure sensor cards are displayed
                        const sensorCard = document.querySelector(`#fullSensorGrid .sensor-card:nth-child(${index + 1})`);
                        if (sensorCard) {
                            sensorCard.style.display = 'block';
                        }
                    });
                }
            }
            
            // Handle data updates specific to each view
            function handleViewSpecificData(view) {
                // Timeout to ensure DOM is ready
                setTimeout(() => {
                    try {
                        // Load data based on the active view
                        if (view === 'sensors') {
                            updateSensorViewData();
                        } 
                        else if (view === 'analytics' && typeof updateAnalyticsChart === 'function') {
                            updateAnalyticsChart('temperature');
                        }
                        else if (view === 'weather' && typeof updateWeatherChart === 'function') {
                            updateWeatherChart();
                        }
                        else if (view === 'notifications') {
                            // Update notifications if needed
                            if (typeof updateNotifications === 'function') {
                                updateNotifications();
                            }
                        }
                        
                        // Update specific charts if functions exist
                        if (typeof updateAllCharts === 'function') {
                            updateAllCharts();
                        }
                    } catch(e) {
                        console.error(`Error updating data for ${view} view:`, e);
                    }
                }, 200);
            }
            
            // Function to update sensor view data
            function updateSensorViewData() {
                if (typeof sensorData !== 'undefined' && sensorData.sensors) {
                    sensorData.sensors.forEach((sensor, index) => {
                        // Update all sensor data fields
                        const updateElement = function(id, value) {
                            const element = document.getElementById(id);
                            if (element) element.textContent = value;
                        };
                        
                        const tempUnit = 'F'; // Default to imperial
                        
                        // Update sensor card data
                        updateElement(`temp${index + 1}Full`, `${sensor.temp}°${tempUnit}`);
                        updateElement(`humid${index + 1}Full`, `${sensor.humid}%`);
                        updateElement(`light${index + 1}Full`, `${sensor.light} Dli`);
                        updateElement(`ph${index + 1}Full`, sensor.ph);
                        updateElement(`battery${index + 1}Full`, `${sensor.battery}%`);
                        
                        // Update timestamps
                        const currentTime = new Date().toLocaleString();
                        updateElement(`lastReading${index + 1}Full`, currentTime);
                        
                        // Ensure sensor cards are displayed
                        const sensorCard = document.querySelector(`#fullSensorGrid .sensor-card:nth-child(${index + 1})`);
                        if (sensorCard) {
                            sensorCard.style.display = 'block';
                        }
                    });
                }
                
                // Update sensor charts with delay to ensure DOM is ready
                setTimeout(() => {
                    if (typeof updateSensorNetworkChart === 'function') {
                        try {
                            updateSensorNetworkChart('sensorNetworkChartFull');
                        } catch(e) {
                            console.error("Error updating sensor network chart:", e);
                        }
                    }
                    
                    if (typeof sensorData !== 'undefined' && sensorData.sensors) {
                        sensorData.sensors.forEach((sensor, index) => {
                            if (typeof updateSensorChart === 'function') {
                                try {
                                    updateSensorChart(`Sensor ${index + 1}`);
                                } catch(e) {
                                    console.error(`Error updating sensor chart ${index + 1}:`, e);
                                }
                            }
                        });
                    }
                }, 300);
            }
            
            // Function to properly update navigation highlighting
            function updateNavHighlight(view) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const navItem = document.querySelector(`.nav-item[onclick*="switchView('${view}')"]`);
                if (navItem) {
                    navItem.classList.add('active');
                }
            }
            
            // Function to fix navigation bar styling
            function fixNavBarStyling() {
                const navBar = document.querySelector('.nav-bar');
                if (navBar) {
                    navBar.setAttribute('style', 
                        'position: fixed !important;' +
                        'bottom: 18px !important;' +
                        'z-index: 9999 !important;' +
                        'left: 50% !important;' +
                        'transform: translateX(-50%) !important;' +
                        'width: calc(100% - 40px);' +
                        'max-width: 450px;' +
                        'min-width: 300px;' +
                        'transition: none !important;' +
                        'background: linear-gradient(135deg, #4caf50, #81c784);' +
                        'padding: 14px 20px;' +
                        'border-radius: 12px;' +
                        'border: 1px solid rgba(255, 255, 255, 0.3);' +
                        'display: flex;' +
                        'justify-content: space-around;' +
                        'align-items: center;' +
                        'opacity: 1;' +
                        'visibility: visible;'
                    );
                }
            }
            
            // Function to toggle sensor details
            function toggleSensor(card, sensorId) {
                if (expandedSensor && expandedSensor !== card) {
                    expandedSensor.classList.remove('expanded');
                }
                card.classList.toggle('expanded');
                expandedSensor = card.classList.contains('expanded') ? card : null;
                
                if (expandedSensor && typeof updateSensorChart === 'function') {
                    setTimeout(() => updateSensorChart(sensorId), 100);
                    
                    // Get sensor index from sensorId (e.g., 'Sensor 1' -> 0)
                    const sensorIndex = parseInt(sensorId.replace('Sensor ', '')) - 1;
                    
                    // Update detailed sensor information when expanded
                    if (sensorData && sensorData.sensors && sensorData.sensors[sensorIndex]) {
                        const sensor = sensorData.sensors[sensorIndex];
                        // Ensure all detailed sensor information is updated
                        updateSensorDetails(sensorIndex, sensor);
                    }
                }
            }
            
            // Function to update all sensor details
            function updateSensorDetails(index, sensor) {
                const updateElement = function(id, value) {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value;
                };
                
                // Update all sensor details elements
                const i = index + 1; // Convert to 1-based index for element IDs
                
                // Basic sensor metrics
                updateElement(`temp${i}Full`, `${sensor.temp}°F`);
                updateElement(`humid${i}Full`, `${sensor.humid}%`);
                updateElement(`light${i}Full`, `${sensor.light} Dli`);
                updateElement(`moisture${i}Full`, `${sensor.moisture}%`);
                updateElement(`ph${i}Full`, `${sensor.ph}`);
                
                // Sensor status information
                updateElement(`lastReading${i}Full`, `${new Date().toLocaleString()}`);
                
                // Crop information if available
                if (sensor.stage) updateElement(`stage${i}`, sensor.stage);
                if (sensor.planting) updateElement(`planting${i}`, sensor.planting);
                if (sensor.harvest) updateElement(`harvest${i}`, sensor.harvest);
                if (sensor.yield) updateElement(`yield${i}`, `${sensor.yield}%`);
            }
            
            // Function to toggle crop details
            function toggleCrop(card, cropType) {
                if (expandedCrop && expandedCrop !== card) {
                    expandedCrop.classList.remove('expanded');
                }
                card.classList.toggle('expanded');
                expandedCrop = card.classList.contains('expanded') ? card : null;
                
                // Update crop chart if available
                if (expandedCrop && typeof updateCropChart === 'function') {
                    setTimeout(() => updateCropChart(cropType), 100);
                }
            }
            
            // Helper to get appropriate icon for each view
            function getIconForView(view) {
                switch(view) {
                    case 'home': return 'home';
                    case 'sensors': return 'microchip';
                    case 'analytics': return 'chart-line';
                    case 'notifications': return 'bell';
                    case 'account': return 'user';
                    case 'weather': return 'cloud-sun';
                    case 'add-sensor': return 'plus';
                    case 'settings': return 'cog';
                    default: return 'leaf';
                }
            }
            
            // Helper to format view name for display
            function formatViewName(view) {
                return view.charAt(0).toUpperCase() + view.slice(1).replace('-', ' ');
            }
            </script>

                                <script>
                                // Detailed State Management with Extensive Functionality
                                let liveUpdate = false;
                                let updateInterval;
                                let expandedSensor = null;
                                let expandedCrop = null;
                                let sensorData = {
                                sensors: [
                                { id: 'Sensor 1', temp: 72, humid: 65, light: 14, ph: 7.5, battery: 95, crop: 'Corn', location: 'Corn Field A, Row 1', status: 'Active' },
                                { id: 'Sensor 2', temp: 71, humid: 64, light: 13.8, ph: 7.4, battery: 88, crop: 'Corn', location: 'Corn Field A, Row 2', status: 'Active' },
                                { id: 'Sensor 3', temp: 73, humid: 66, light: 14.2, ph: 7.6, battery: 92, crop: 'Wheat', location: 'Wheat Field B, Row 1', status: 'Active' },
                                { id: 'Sensor 4', temp: 70, humid: 63, light: 13.5, ph: 7.3, battery: 90, crop: 'Wheat', location: 'Wheat Field B, Row 2', status: 'Active' }
                                ],
                                weather: { temp: 72, humid: 65, wind: 8, precip: 10 },
                                crops: {
                                'Corn': { health: 'Good', water: 'Moderate', moisture: 65, temp: 72, light: 14, ph: 7.5, planting: '2023-04-15', harvest: '2023-09-30', stage: 'Flowering', yield: 85 },
                                'Wheat': { health: 'Excellent', water: 'Low', moisture: 63, temp: 71, light: 13.8, ph: 7.4, planting: '2023-03-20', harvest: '2023-08-15', stage: 'Grain Fill', yield: 90 },
                                'Soybeans': { health: 'Good', water: 'Moderate', moisture: 66, temp: 73, light: 14.5, ph: 7.6, planting: '2023-05-01', harvest: '2023-10-10', stage: 'Pod Setting', yield: 82 }
                                },
                                tasks: [
                                { title: "Irrigation Completed", details: "Corn Field A irrigated with 200 gal", time: "2023-11-28 08:00", status: "completed" },
                                { title: "Fertilizer Applied", details: "Wheat Field B fertilized with 20 kg", time: "2023-11-27 14:30", status: "completed" }
                                ],
                                logs: []
                                };
                                let notifications = [
                                { title: "Low Battery Warning", text: "Sensor 2 battery at 88%", time: "5 minutes ago", type: "warning" }
                                ];
                                let unitSystem = 'imperial';
                                let language = 'en';

                                // View Switching with Enhanced Logic
                                function switchView(view) {
                                  try {
                                    console.log(`Switching to view: ${view}`);
                                    
                                    // Define all possible views
                                    const views = ['home', 'sensors', 'analytics', 'notifications', 'account', 'weather', 'add-sensor', 'settings'];
                                    
                                    // Hide all views first
                                    views.forEach(v => {
                                      const viewElement = document.querySelector(`.${v}-view`);
                                      if (viewElement) {
                                        viewElement.classList.remove('active');
                                        viewElement.style.display = 'none';
                                      }
                                    });

                                    // Show the selected view
                                    const selectedView = document.querySelector(`.${view}-view`);
                                    if (selectedView) {
                                      selectedView.classList.add('active');
                                      selectedView.style.display = 'block';
                                      console.log(`View ${view} activated`);
                                    } else {
                                      console.error(`View element .${view}-view not found`);
                                      // If view not found, default to home
                                      const homeView = document.querySelector('.home-view');
                                      if (homeView) {
                                        homeView.classList.add('active');
                                        homeView.style.display = 'block';
                                        view = 'home';
                                      }
                                    }

                                    // Update navigation bar active state
                                    updateNavHighlight(view);

                                    // Handle special views
                                    if (view === 'analytics' && typeof showAnalytics === 'function') {
                                      setTimeout(() => showAnalytics('temperature'), 100);
                                    }

                                    if (view === 'weather' && typeof updateWeatherChart === 'function') {
                                      setTimeout(() => updateWeatherChart(), 100);
                                    }

                                    // Collapse any expanded items
                                    if (expandedSensor) {
                                      expandedSensor.classList.remove('expanded');
                                      expandedSensor = null;
                                    }

                                    if (expandedCrop) {
                                      expandedCrop.classList.remove('expanded');
                                      expandedCrop = null;
                                    }

                                    // Update counters
                                    const alertCountElem = document.getElementById('alertCount');
                                    if (alertCountElem && notifications) {
                                      alertCountElem.textContent = notifications.length;
                                    }

                                    if (sensorData && sensorData.tasks) {
                                      const pendingTasksElem = document.getElementById('pendingTasks');
                                      if (pendingTasksElem) {
                                        pendingTasksElem.textContent = sensorData.tasks.filter(t => t.status === 'pending').length;
                                      }

                                      const completedTasksElem = document.getElementById('completedTasks');
                                      if (completedTasksElem) {
                                        completedTasksElem.textContent = sensorData.tasks.filter(t => 
                                          t.status === 'completed' && 
                                          new Date(t.time).toDateString() === new Date().toDateString()
                                        ).length;
                                      }
                                    }

                                    // Update charts with slight delay to ensure DOM is ready
                                    if (typeof updateAllCharts === 'function') {
                                      setTimeout(() => updateAllCharts(), 200);
                                    }

                                    // Scroll to top of the view
                                    const contentDiv = document.querySelector('.content');
                                    if (contentDiv) contentDiv.scrollTop = 0;

                                    // Add to log
                                    if (typeof addLogEntry === 'function') {
                                      addLogEntry(`Switched to ${view} view`);
                                    }

                                  } catch (error) {
                                    console.error("Error in switchView:", error);
                                    // Try to recover by showing home view
                                    const homeView = document.querySelector('.home-view');
                                    if (homeView) {
                                      homeView.style.display = 'block';
                                      homeView.classList.add('active');
                                      updateNavHighlight('home');
                                    }
                                  }
                                }

                                // Search Functionality with Detailed Filtering
                                function performSearch() {
                                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                                const sensorCards = document.querySelectorAll('#sensorGrid .sensor-card, #fullSensorGrid .sensor-card');
                                const cropCards = document.querySelectorAll('#cropGrid .sensor-card');
                                sensorCards.forEach(card => {
                                const title = card.querySelector('.sensor-title').textContent.toLowerCase();
                                card.style.display = title.includes(searchTerm) ? 'block' : 'none';
                                });
                                cropCards.forEach(card => {
                                const title = card.querySelector('.sensor-title').textContent.toLowerCase();
                                card.style.display = title.includes(searchTerm) ? 'block' : 'none';
                                });
                                }

                                // Sensor and Crop Expansion Logic
                                function toggleSensor(card, sensorId) {
                                if (expandedSensor && expandedSensor !== card) {
                                expandedSensor.classList.remove('expanded');
                                }
                                card.classList.toggle('expanded');
                                expandedSensor = card.classList.contains('expanded') ? card : null;
                                if (expandedSensor) {
                                updateSensorChart(sensorId);
                                }
                                }

                                function toggleCrop(card, cropType) {
                                if (expandedCrop && expandedCrop !== card) {
                                expandedCrop.classList.remove('expanded');
                                }
                                card.classList.toggle('expanded');
                                expandedCrop = card.classList.contains('expanded') ? card : null;
                                if (expandedCrop) {
                                updateCropChart(cropType);
                                }
                                }

                                function toggleAllSensors() {
                                const cards = document.querySelectorAll('.sensor-card');
                                const allExpanded = Array.from(cards).every(card => card.classList.contains('expanded'));
                                cards.forEach((card, index) => {
                                if (allExpanded) {
                                card.classList.remove('expanded');
                                } else {
                                card.classList.add('expanded');
                                updateSensorChart(`Sensor ${index + 1}`);
                                }
                                });
                                expandedSensor = allExpanded ? null : true;
                                }

                                // Real-Time Data Updates with Detailed Simulation
                                function toggleLiveUpdate() {
                                liveUpdate = !liveUpdate;
                                document.getElementById('liveStatus').textContent = liveUpdate ? 'On' : 'Off';
                                if (liveUpdate) {
                                const freq = parseInt(document.getElementById('updateFreq').value);
                                updateInterval = setInterval(updateSensorData, freq);
                                } else {
                                clearInterval(updateInterval);
                                }
                                addLogEntry(`Live update ${liveUpdate ? 'enabled' : 'disabled'}`);
                                }

                                function updateSensorData() {
                                sensorData.sensors.forEach((sensor, index) => {
                                // Use Number to ensure we're working with numbers, not strings
                                let tempValue = Number(sensor.temp);
                                let humidValue = Number(sensor.humid);
                                let lightValue = Number(sensor.light);
                                let phValue = Number(sensor.ph);
                                let batteryValue = Number(sensor.battery);

                                // Calculate new values
                                if (unitSystem === 'imperial') {
                                    tempValue = tempValue + (Math.random() - 0.5) * 2;
                                } else {
                                    tempValue = (tempValue - 32) * 5/9 + (Math.random() - 0.5) * 1;
                                }

                                humidValue = humidValue + (Math.random() - 0.5) * 4;
                                lightValue = lightValue + (Math.random() - 0.5) * 1.5;
                                phValue = phValue + (Math.random() - 0.5) * 0.3;
                                batteryValue = Math.max(0, batteryValue - Math.random() * 0.3);

                                // Store the updated values back as strings with fixed precision
                                sensor.temp = tempValue.toFixed(1);
                                sensor.humid = humidValue.toFixed(1);
                                sensor.light = lightValue.toFixed(1);
                                sensor.ph = phValue.toFixed(1);
                                sensor.battery = batteryValue.toFixed(1);

                                const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';

                                // Safely update DOM elements
                                function updateElement(id, value) {
                                    const element = document.getElementById(id);
                                    if (element) element.textContent = value;
                                }

                                updateElement(`temp${index + 1}`, `${sensor.temp}${tempUnit}`);
                                updateElement(`humid${index + 1}`, `${sensor.humid}%`);
                                updateElement(`light${index + 1}`, `${sensor.light} Dli`);
                                updateElement(`ph${index + 1}`, sensor.ph);
                                updateElement(`battery${index + 1}`, `${sensor.battery}%`);
                                updateElement(`temp${index + 1}Full`, `${sensor.temp}${tempUnit}`);
                                updateElement(`humid${index + 1}Full`, `${sensor.humid}%`);
                                updateElement(`light${index + 1}Full`, `${sensor.light} Dli`);
                                updateElement(`ph${index + 1}Full`, sensor.ph);
                                updateElement(`battery${index + 1}Full`, `${sensor.battery}%`);
                                updateElement(`lastReading${index + 1}`, new Date().toLocaleString());
                                updateElement(`lastReading${index + 1}Full`, new Date().toLocaleString());
                                });

                                const avgTemp = sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.temp), 0) / sensorData.sensors.length;
                                const avgHumid = sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.humid), 0) / sensorData.sensors.length;
                                const avgLight = sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.light), 0) / sensorData.sensors.length;
                                const avgPh = sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.ph), 0) / sensorData.sensors.length;
                                const avgBattery = sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.battery), 0) / sensorData.sensors.length;

                                const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';
                                document.getElementById('avgTemp').textContent = `${avgTemp.toFixed(1)}${tempUnit}`;
                                document.getElementById('avgHumidity').textContent = `${avgHumid.toFixed(1)}%`;
                                document.getElementById('avgLight').textContent = `${avgLight.toFixed(1)} Dli`;
                                document.getElementById('avgPh').textContent = avgPh.toFixed(1);
                                document.getElementById('avgBattery').textContent = `${avgBattery.toFixed(1)}%`;
                                document.getElementById('tempProgress').style.width = `${Math.min(100, avgTemp)}%`;
                                document.getElementById('humidProgress').style.width = `${Math.min(100, avgHumid)}%`;
                                document.getElementById('lightProgress').style.width = `${Math.min(100, avgLight * 5)}%`;
                                document.getElementById('phProgress').style.width = `${Math.min(100, avgPh * 10)}%`;
                                document.getElementById('batteryProgress').style.width = `${avgBattery}%`;

                                sensorData.weather.temp = avgTemp;
                                sensorData.weather.humid = avgHumid;
                                document.getElementById('weatherTemp').textContent = `${avgTemp.toFixed(1)}${tempUnit}`;
                                document.getElementById('weatherHumid').textContent = `${avgHumid.toFixed(1)}%`;
                                document.getElementById('detailedWeatherTemp').textContent = `${avgTemp.toFixed(1)}${tempUnit}`;
                                document.getElementById('detailedWeatherHumid').textContent = `${avgHumid.toFixed(1)}%`;

                                // Update Crop Data
                                sensorData.crops['Corn'].moisture = avgHumid;
                                sensorData.crops['Corn'].temp = avgTemp;
                                sensorData.crops['Corn'].light = avgLight;
                                sensorData.crops['Corn'].ph = avgPh;
                                sensorData.crops['Wheat'].moisture = avgHumid - 2;
                                sensorData.crops['Wheat'].temp = avgTemp - 1;
                                sensorData.crops['Wheat'].light = avgLight - 0.4;
                                sensorData.crops['Wheat'].ph = avgPh - 0.1;
                                sensorData.crops['Soybeans'].moisture = avgHumid + 1;
                                sensorData.crops['Soybeans'].temp = avgTemp + 1;
                                sensorData.crops['Soybeans'].light = avgLight + 0.5;
                                sensorData.crops['Soybeans'].ph = avgPh + 0.1;

                                document.getElementById('cornMoisture').textContent = `${sensorData.crops['Corn'].moisture.toFixed(1)}%`;
                                document.getElementById('cornTemp').textContent = `${sensorData.crops['Corn'].temp.toFixed(1)}${tempUnit}`;
                                document.getElementById('cornLight').textContent = `${sensorData.crops['Corn'].light.toFixed(1)} Dli`;
                                document.getElementById('cornPh').textContent = sensorData.crops['Corn'].ph.toFixed(1);
                                document.getElementById('wheatMoisture').textContent = `${sensorData.crops['Wheat'].moisture.toFixed(1)}%`;
                                document.getElementById('wheatTemp').textContent = `${sensorData.crops['Wheat'].temp.toFixed(1)}${tempUnit}`;
                                document.getElementById('wheatLight').textContent = `${sensorData.crops['Wheat'].light.toFixed(1)} Dli`;
                                document.getElementById('wheatPh').textContent = sensorData.crops['Wheat'].ph.toFixed(1);
                                document.getElementById('soyMoisture').textContent = `${sensorData.crops['Soybeans'].moisture.toFixed(1)}%`;
                                document.getElementById('soyTemp').textContent = `${sensorData.crops['Soybeans'].temp.toFixed(1)}${tempUnit}`;
                                document.getElementById('soyLight').textContent = `${sensorData.crops['Soybeans'].light.toFixed(1)} Dli`;
                                document.getElementById('soyPh').textContent = sensorData.crops['Soybeans'].ph.toFixed(1);

                                // Update Analytics Trends
                                document.getElementById('trendTemp').textContent = `${avgTemp.toFixed(1)}${tempUnit}`;
                                document.getElementById('minTemp').textContent = `${Math.min(...sensorData.sensors.map(s => parseFloat(s.temp))).toFixed(1)}${tempUnit}`;
                                document.getElementById('maxTemp').textContent = `${Math.max(...sensorData.sensors.map(s => parseFloat(s.temp))).toFixed(1)}${tempUnit}`;
                                document.getElementById('trendHumid').textContent = `${avgHumid.toFixed(1)}%`;
                                document.getElementById('minHumid').textContent = `${Math.min(...sensorData.sensors.map(s => parseFloat(s.humid))).toFixed(1)}%`;
                                document.getElementById('maxHumid').textContent = `${Math.max(...sensorData.sensors.map(s => parseFloat(s.humid))).toFixed(1)}%`;
                                document.getElementById('trendLight').textContent = `${avgLight.toFixed(1)} Dli`;
                                document.getElementById('minLight').textContent = `${Math.min(...sensorData.sensors.map(s => parseFloat(s.light))).toFixed(1)} Dli`;
                                document.getElementById('maxLight').textContent = `${Math.max(...sensorData.sensors.map(s => parseFloat(s.light))).toFixed(1)} Dli`;
                                document.getElementById('trendPh').textContent = avgPh.toFixed(1);
                                document.getElementById('minPh').textContent = Math.min(...sensorData.sensors.map(s => parseFloat(s.ph))).toFixed(1);
                                document.getElementById('maxPh').textContent = Math.max(...sensorData.sensors.map(s => parseFloat(s.ph))).toFixed(1);
                                document.getElementById('trendBattery').textContent = `${avgBattery.toFixed(1)}%`;
                                document.getElementById('minBattery').textContent = `${Math.min(...sensorData.sensors.map(s => parseFloat(s.battery))).toFixed(1)}%`;
                                document.getElementById('maxBattery').textContent = `${Math.max(...sensorData.sensors.map(s => parseFloat(s.battery))).toFixed(1)}%`;

                                const avgYield = (sensorData.crops['Corn'].yield + sensorData.crops['Wheat'].yield + sensorData.crops['Soybeans'].yield) / 3;
                                document.getElementById('trendYield').textContent = `${avgYield.toFixed(1)}%`;
                                document.getElementById('trendCornYield').textContent = `${sensorData.crops['Corn'].yield}%`;
                                document.getElementById('trendWheatYield').textContent = `${sensorData.crops['Wheat'].yield}%`;
                                document.getElementById('cropHealth').textContent = `${avgYield.toFixed(1)}%`;
                                document.getElementById('healthProgress').style.width = `${avgYield}%`;
                                document.getElementById('avgYield').textContent = `${avgYield.toFixed(1)}%`;

                                // Alerts
                                const tempThreshold = parseFloat(document.getElementById('tempThreshold').value);
                                const humidThreshold = parseFloat(document.getElementById('humidThreshold').value);
                                if (avgTemp > tempThreshold && document.getElementById('notifyToggle').checked) {
                                addNotification("High Temperature Alert", `Average temperature exceeds ${tempThreshold}${tempUnit}`, "warning");
                                }
                                if (avgHumid < humidThreshold) {
                                addNotification("Low Humidity Alert", `Average humidity below ${humidThreshold}%`, "warning");
                                }
                                if (avgBattery < 20) {
                                addNotification("Critical Battery Alert", "Average sensor battery below 20%", "warning");
                                }
                                document.getElementById('alertProgress').style.width = `${Math.min(100, notifications.length * 10)}%`;
                                updateAllCharts();
                                addLogEntry("Sensor data updated");
                                }

                                // Chart Updates
                                function updateAllCharts() {
                                updateOverviewChart();
                                updateCropOverviewChart();
                                updateSensorNetworkChart('sensorNetworkChart');
                                updateSensorNetworkChart('sensorNetworkChartFull');
                                updateWeatherTrendChart();
                                updatePerformanceChart();
                                updateAccountUsageChart();
                                updateAlertTrendChart();
                                updatePredictiveChart();
                                updateResourceChart();
                                updateEquipmentChart();
                                sensorData.sensors.forEach((_, index) => updateSensorChart(`Sensor ${index + 1}`));
                                updateCropChart('Corn');
                                updateCropChart('Wheat');
                                updateCropChart('Soybeans');
                                }

                                function updateOverviewChart() {
                                const ctx = document.getElementById('overviewChart');
                                if(ctx) {
                                  try {
                                    new Chart(ctx.getContext('2d'), {
                                      type: 'line',
                                      data: {
                                        labels: Array(6).fill().map((_, i) => `T-${5-i}h`),
                                        datasets: [
                                        {
                                          label: 'Temp',
                                          data: Array(6).fill().map(() => sensorData.weather.temp + (Math.random() - 0.5) * 6),
                                          borderColor: 'rgba(76, 175, 80, 1)',
                                          backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                          fill: true,
                                          tension: 0.4
                                        },
                                        {
                                          label: 'Humid',
                                          data: Array(6).fill().map(() => sensorData.weather.humid + (Math.random() - 0.5) * 12),
                                          borderColor: 'rgba(33, 150, 243, 1)',
                                          backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                          fill: true,
                                          tension: 0.4
                                        }
                                        ]
                                      },
                                      options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                          y: { beginAtZero: false }
                                        },
                                        plugins: {
                                          legend: {
                                            display: true,
                                            labels: {
                                              boxWidth: 10,
                                              font: {
                                                size: 10
                                              }
                                            }
                                          }
                                        }
                                      }
                                    });
                                  } catch(e) {
                                    console.log("Error updating overview chart", e);
                                  }
                                }
                                }

                                function updateCropOverviewChart() {
                                const ctx = document.getElementById('cropOverviewChart').getContext('2d');
                                new Chart(ctx, {
                                type: 'bar',
                                data: {
                                labels: ['Corn', 'Wheat', 'Soybeans'],
                                datasets: [
                                {
                                label: 'Yield Forecast (%)',
                                data: [sensorData.crops['Corn'].yield, sensorData.crops['Wheat'].yield, sensorData.crops['Soybeans'].yield],
                                backgroundColor: 'rgba(76, 175, 80, 0.5)',
                                borderColor: 'rgba(76, 175, 80, 1)',
                                borderWidth: 1
                                },
                                {
                                label: 'Moisture (%)',
                                data: [sensorData.crops['Corn'].moisture, sensorData.crops['Wheat'].moisture, sensorData.crops['Soybeans'].moisture],
                                backgroundColor: 'rgba(33, 150, 243, 0.5)',
                                borderColor: 'rgba(33, 150, 243, 1)',
                                borderWidth: 1
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: true }
                                }
                                }
                                });
                                }

                                function updateSensorNetworkChart(chartId) {
                                const ctx = document.getElementById(chartId).getContext('2d');
                                new Chart(ctx, {
                                type: 'radar',
                                data: {
                                labels: sensorData.sensors.map(s => s.id),
                                datasets: [
                                {
                                label: 'Battery (%)',
                                data: sensorData.sensors.map(s => s.battery),
                                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                borderColor: 'rgba(76, 175, 80, 1)',
                                borderWidth: 2
                                },
                                {
                                label: 'Temperature',
                                data: sensorData.sensors.map(s => unitSystem === 'imperial' ? s.temp / 100 : s.temp / 40),
                                backgroundColor: 'rgba(255, 193, 7, 0.2)',
                                borderColor: 'rgba(255, 193, 7, 1)',
                                borderWidth: 2
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                r: { beginAtZero: true, max: 1 }
                                }
                                }
                                });
                                }

                                function updateWeatherTrendChart() {
                                const ctx = document.getElementById('weatherTrendChart').getContext('2d');
                                new Chart(ctx, {
                                type: 'line',
                                data: {
                                labels: Array(24).fill().map((_, i) => `${i}:00`),
                                datasets: [
                                {
                                label: 'Temperature',
                                data: Array(24).fill().map(() => sensorData.weather.temp + (Math.random() - 0.5) * 7),
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                fill: true,
                                tension: 0.4
                                },
                                {
                                label: 'Humidity',
                                data: Array(24).fill().map(() => sensorData.weather.humid + (Math.random() - 0.5) * 15),
                                borderColor: 'rgba(33, 150, 243, 1)',
                                backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                fill: true,
                                tension: 0.4
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: false }
                                }
                                }
                                });
                                }

                                function updatePerformanceChart() {
                                const ctx = document.getElementById('performanceChart').getContext('2d');
                                new Chart(ctx, {
                                type: 'bar',
                                data: {
                                labels: ['Corn', 'Wheat', 'Soybeans'],
                                datasets: [
                                {
                                label: 'Yield Forecast (%)',
                                data: [sensorData.crops['Corn'].yield, sensorData.crops['Wheat'].yield, sensorData.crops['Soybeans'].yield],
                                backgroundColor: 'rgba(76, 175, 80, 0.5)',
                                borderColor: 'rgba(76, 175, 80, 1)',
                                borderWidth: 1
                                },
                                {
                                label: 'Water Usage (gal)',
                                data: [200, 150, 100],
                                backgroundColor: 'rgba(33, 150, 243, 0.5)',
                                borderColor: 'rgba(33, 150, 243, 1)',
                                borderWidth: 1
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: true }
                                }
                                }
                                });
                                }

                                function updateAccountUsageChart() {
                                const ctx = document.getElementById('accountUsageChart').getContext('2d');
                                new Chart(ctx, {
                                type: 'doughnut',
                                data: {
                                labels: ['Sensors Used', 'Sensors Available', 'Storage Used', 'Storage Available'],
                                datasets: [{
                                data: [4, 16, 1.2, 3.8],
                                backgroundColor: [
                                'rgba(76, 175, 80, 0.8)',
                                'rgba(76, 175, 80, 0.2)',
                                'rgba(33, 150, 243, 0.8)',
                                'rgba(33, 150, 243, 0.2)'
                                ],
                                borderWidth: 1
                                }]
                                },
                                options: {
                                responsive: true
                                }
                                });
                                }

                                function updateAlertTrendChart() {
                                const ctx = document.getElementById('alertTrendChart').getContext('2d');
                                new Chart(ctx, {
                                type: 'line',
                                data: {
                                labels: Array(7).fill().map((_, i) => `Day ${i + 1}`),
                                datasets: [{
                                label: 'Alerts',
                                data: [1, 0, 2, 1, 0, 1, notifications.length],
                                borderColor: 'rgba(255, 152, 0, 1)',
                                backgroundColor: 'rgba(255, 152, 0, 0.2)',
                                fill: true,
                                tension: 0.4
                                }]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: true }
                                }
                                }
                                });
                                }

                                function updateSensorChart(sensorId) {
                                const index = parseInt(sensorId.split(' ')[1]) - 1;
                                const sensor = sensorData.sensors[index];
                                const ctx = document.getElementById(`sensorChart${index + 1}`);
                                const ctxFull = document.getElementById(`sensorChart${index + 1}Full`);
                                const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';

                                if(ctx) {
                                  try {
                                    new Chart(ctx.getContext('2d'), {
                                      type: 'line',
                                      data: {
                                        labels: Array(6).fill().map((_, i) => `T-${5-i}h`),
                                        datasets: [
                                        {
                                          label: `Temp`,
                                          data: Array(6).fill().map(() => sensor.temp + (Math.random() - 0.5) * 3),
                                          borderColor: 'rgba(76, 175, 80, 1)',
                                          backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                          fill: true,
                                          tension: 0.4
                                        },
                                        {
                                          label: 'Humid',
                                          data: Array(6).fill().map(() => sensor.humid + (Math.random() - 0.5) * 6),
                                          borderColor: 'rgba(33, 150, 243, 1)',
                                          backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                          fill: true,
                                          tension: 0.4
                                        }
                                        ]
                                      },
                                      options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                          y: { beginAtZero: false }
                                        },
                                        plugins: {
                                          legend: {
                                            display: true,
                                            labels: {
                                              boxWidth: 10,
                                              font: {
                                                size: 10
                                              }
                                            }
                                          }
                                        }
                                      }
                                    });
                                  } catch(e) {
                                    console.log("Error updating sensor chart", e);
                                  }
                                }
                                new Chart(ctxFull, {
                                type: 'line',
                                data: {
                                labels: Array(24).fill().map((_, i) => `T-${23-i}h`),
                                datasets: [
                                {
                                label: `Temp (${tempUnit})`,
                                data: Array(24).fill().map(() => sensor.temp + (Math.random() - 0.5) * 4),
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                fill: true,
                                tension: 0.4
                                },
                                {
                                label: 'Humidity (%)',
                                data: Array(24).fill().map(() => sensor.humid + (Math.random() - 0.5) * 8),
                                borderColor: 'rgba(33, 150, 243, 1)',
                                backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                fill: true,
                                tension: 0.4
                                },
                                {
                                label: 'Light (Dli)',
                                data: Array(24).fill().map(() => sensor.light + (Math.random() - 0.5) * 2),
                                borderColor: 'rgba(255, 193, 7, 1)',
                                backgroundColor: 'rgba(255, 193, 7, 0.2)',
                                fill: true,
                                tension: 0.4
                                },
                                {
                                label: 'pH',
                                data: Array(24).fill().map(() => sensor.ph + (Math.random() - 0.5) * 0.4),
                                borderColor: 'rgba(156, 39, 176, 1)',
                                backgroundColor: 'rgba(156, 39, 176, 0.2)',
                                fill: true,
                                tension: 0.4
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: false }
                                }
                                }
                                });
                                }

                                function updateCropChart(cropType) {
                                const crop = sensorData.crops[cropType];
                                const ctx = document.getElementById(`${cropType.toLowerCase()}Chart`).getContext('2d');
                                const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';
                                new Chart(ctx, {
                                type: 'line',
                                data: {
                                labels: Array(12).fill().map((_, i) => `T-${11-i}d`),
                                datasets: [
                                {
                                label: `Temp (${tempUnit})`,
                                data: Array(12).fill().map(() => crop.temp + (Math.random() - 0.5) * 5),
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                fill: true,
                                tension: 0.4
                                },
                                {
                                label: 'Moisture (%)',
                                data: Array(12).fill().map(() => crop.moisture + (Math.random() - 0.5) * 10),
                                borderColor: 'rgba(33, 150, 243, 1)',
                                backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                fill: true,
                                tension: 0.4
                                }
                                ]
                                },
                                options: {
                                responsive: true,
                                scales: {
                                y: { beginAtZero: false }
                                }
                                }
                                });
                                }

                                function showAnalytics(type) {
                                  updateAnalyticsChart(type);
                                }

                                // Notifications Management
                                function addNotification(title, text, type) {
                                notifications.push({ title, text, time: new Date().toLocaleTimeString(), type });
                                updateNotifications();
                                addLogEntry(`Notification added: ${title}`);
                                }

                                function updateNotifications() {
                                const list = document.getElementById('notificationList');
                                list.innerHTML = notifications.map(n => `
                                <div class="notification-item ${n.type}">
                                <div class="notification-icon ${n.type}">
                                <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="notification-content">
                                <div class="notification-title">${n.title}</div>
                                <div class="notification-text">${n.text}</div>
                                <div class="notification-time">${n.time}</div>
                                </div>
                                </div>
                                `).join('');
                                document.getElementById('alertCount').textContent = notifications.length;
                                document.getElementById('alertProgress').style.width = `${Math.min(100, notifications.length * 10)}%`;
                                }

                                function clearNotifications() {
                                notifications = [];
                                updateNotifications();
                                addNotification("Notifications Cleared", "All alerts have been cleared", "success");
                                addLogEntry("Notifications cleared");
                                }

                                function archiveAlerts() {
                                sensorData.logs = sensorData.logs.concat(notifications.map(n => ({ type: 'alert', title: n.title, text: n.text, time: n.time })));
                                clearNotifications();
                                addNotification("Alerts Archived", "All alerts moved to log", "success");
                                addLogEntry("Alerts archived");
                                }

                                function setAlertRules() {
                                alert("Set alert rules functionality to be implemented: Define thresholds for temp, humidity, etc.");
                                addLogEntry("Alert rules setting initiated");
                                }

                                // Data Export and Actions
                                function exportData() {
                                const data = JSON.stringify(sensorData, null, 2);
                                const blob = new Blob([data], { type: 'application/json' });
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = 'agrisense_data.json';
                                a.click();
                                URL.revokeObjectURL(url);
                                addNotification("Data Exported", "Farm data saved as JSON", "success");
                                addLogEntry("Data exported");
                                }

                                function generateReport() {
                                alert("Generating comprehensive farm report: Includes sensor data, crop status, and weather trends.");
                                addNotification("Report Generated", "Farm report created", "success");
                                addLogEntry("Report generated");
                                }

                                function runDiagnostics() {
                                alert("Running system diagnostics: Checking sensors, network, and data integrity.");
                                addNotification("Diagnostics Complete", "All systems operational", "success");
                                addLogEntry("Diagnostics run");
                                }

                                function syncAll() {
                                updateSensorData();
                                addNotification("Systems Synced", "All data synchronized", "success");
                                addLogEntry("All systems synced");
                                }

                                function scheduleIrrigation(cropType = 'All') {
                                const task = `Irrigation scheduled for ${cropType} fields`;
                                sensorData.tasks.push({ title: "Irrigation Scheduled", details: task, time: new Date().toLocaleString(), status: "pending" });
                                addNotification("Irrigation Scheduled", task, "success");
                                addLogEntry(task);
                                updateSensorData();
                                }

                                function applyFertilizer(cropType = 'All') {
                                const task = `Fertilizer applied to ${cropType} fields`;
                                sensorData.tasks.push({ title: "Fertilizer Applied", details: task, time: new Date().toLocaleString(), status: "completed" });
                                addNotification("Fertilizer Applied", task, "success");
                                addLogEntry(task);
                                }

                                function monitorPests(cropType = 'All') {
                                const task = `Pest monitoring initiated for ${cropType} fields`;
                                sensorData.tasks.push({ title: "Pest Monitoring", details: task, time: new Date().toLocaleString(), status: "pending" });
                                addNotification("Pest Monitoring", task, "success");
                                addLogEntry(task);
                                }

                                function addCrop() {
                                alert("Add new crop functionality to be implemented: Specify type, planting date, etc.");
                                addLogEntry("Crop addition initiated");
                                }

                                function calibrateSensors() {
                                sensorData.sensors.forEach(s => s.lastCalibration = new Date().toLocaleDateString());
                                addNotification("Sensors Calibrated", "All sensors recalibrated", "success");
                                addLogEntry("All sensors calibrated");
                                }

                                function syncSensors() {
                                updateSensorData();
                                addNotification("Sensors Synced", "Sensor data synchronized", "success");
                                addLogEntry("Sensors synced");
                                }

                                    function resetSensors() {
                                    sensorData.sensors.forEach(s => {
                                        s.battery = 100;
                                        s.status = 'Active';
                                    });
                                    updateSensorData();
                                    addNotification("Sensors Reset", "All sensors reset to full capacity", "success");
                                    addLogEntry("Sensors reset");
                                    }

                                    function exportSensorData() {
                                    const sensorExport = JSON.stringify(sensorData.sensors, null, 2);
                                    const blob = new Blob([sensorExport], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'sensor_data.json';
                                    a.click();
                                    URL.revokeObjectURL(url);
                                    addNotification("Sensor Data Exported", "Sensor data saved as JSON", "success");
                                    addLogEntry("Sensor data exported");
                                    }

                                    function calibrateSensor(sensorId) {
                                    const sensor = sensorData.sensors.find(s => s.id === sensorId);
                                    sensor.lastCalibration = new Date().toLocaleDateString();
                                    addNotification(`Sensor ${sensorId} Calibrated`, `Calibration completed for ${sensorId}`, "success");
                                    addLogEntry(`Sensor ${sensorId} calibrated`);
                                    updateSensorData();
                                    }

                                    function deactivateSensor(sensorId) {
                                    const sensor = sensorData.sensors.find(s => s.id === sensorId);
                                    sensor.status = 'Offline';
                                    sensor.battery = 0;
                                    addNotification(`Sensor ${sensorId} Deactivated`, `${sensorId} taken offline`, "warning");
                                    addLogEntry(`Sensor ${sensorId} deactivated`);
                                    updateSensorData();
                                    }

                                    function viewSensorLogs(sensorId) {
                                    alert(`Viewing logs for ${sensorId}: To be implemented with detailed sensor history.`);
                                    addLogEntry(`Viewed logs for ${sensorId}`);
                                    }

                                    function adjustIrrigation() {
                                    alert("Adjusting irrigation based on weather forecast: To be implemented with weather data integration.");
                                    addNotification("Irrigation Adjusted", "Irrigation adjusted based on weather", "success");
                                    addLogEntry("Irrigation adjusted");
                                    }

                                    function downloadWeatherData() {
                                    const weatherExport = JSON.stringify(sensorData.weather, null, 2);
                                    const blob = new Blob([weatherExport], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'weather_data.json';
                                    a.click();
                                    URL.revokeObjectURL(url);
                                    addNotification("Weather Data Exported", "Weather data saved as JSON", "success");
                                    addLogEntry("Weather data exported");
                                    }

                                    function setWeatherThresholds() {
                                    alert("Set weather thresholds functionality to be implemented: Define temp, humidity, etc.");
                                    addLogEntry("Weather thresholds setting initiated");
                                    }

                                    function viewHourlyForecast() {
                                    alert("Viewing hourly weather forecast: To be implemented with detailed hourly data.");
                                    addLogEntry("Viewed hourly weather forecast");
                                    }

                                    function viewWeeklyForecast() {
                                    alert("Viewing weekly weather forecast: To be implemented with detailed weekly data.");
                                    addLogEntry("Viewed weekly weather forecast");
                                    }

                                    function viewWeatherHistory() {
                                    alert("Viewing weather history: To be implemented with historical weather data.");
                                    addLogEntry("Viewed weather history");
                                    }

                                    function upgradePlan() {
                                    alert("Upgrade plan functionality to be implemented: Contact support for options.");
                                    addLogEntry("Plan upgrade initiated");
                                    }

                                    function manageUsers() {
                                    alert("Manage users functionality to be implemented: Add/remove farm users.");
                                    addLogEntry("User management initiated");
                                    }

                                    function exportAccountData() {
                                    const accountExport = JSON.stringify({ user: "Farmer John Doe", plan: "Professional Elite", sensors: sensorData.sensors.length }, null, 2);
                                    const blob = new Blob([accountExport], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'account_data.json';
                                    a.click();
                                    URL.revokeObjectURL(url);
                                    addNotification("Account Data Exported", "Account data saved as JSON", "success");
                                    addLogEntry("Account data exported");
                                    }

                                    function viewAllActions() {
                                    alert("Viewing all actions: To be implemented with full action list.");
                                    addLogEntry("Viewed all actions");
                                    }

                                    function scheduleTask() {
                                    alert("Scheduling new task: To be implemented with task details form.");
                                    addLogEntry("Task scheduling initiated");
                                    }

                                    function viewTaskHistory() {
                                    alert("Viewing task history: To be implemented with historical task data.");
                                    addLogEntry("Viewed task history");
                                    }

                                    function orderFertilizer() {
                                    alert("Ordering fertilizer: To be implemented with order form.");
                                    addNotification("Fertilizer Ordered", "Order placed for fertilizer", "success");
                                    addLogEntry("Fertilizer ordered");
                                    }

                                    function checkEquipment() {
                                    alert("Checking equipment status: To be implemented with equipment details.");
                                    addNotification("Equipment Checked", "All equipment operational", "success");
                                    addLogEntry("Equipment status checked");
                                    }

                                    function updateFirmware() {
                                    alert("Updating sensor firmware: To be implemented with firmware update process.");
                                    addNotification("Firmware Updated", "All sensors updated to latest version", "success");
                                    addLogEntry("Firmware updated");
                                    }

                                    function orderSeeds() {
                                    alert("Ordering seeds: To be implemented with seed order form.");
                                    addNotification("Seeds Ordered", "Order placed for seeds", "success");
                                    addLogEntry("Seeds ordered");
                                    }

                                    function manageInventory() {
                                    alert("Managing inventory: To be implemented with inventory management interface.");
                                    addLogEntry("Inventory management initiated");
                                    }

                                    function viewTaskStatus() {
                                    alert("Viewing task status: To be implemented with detailed task overview.");
                                    addLogEntry("Viewed task status");
                                    }

                                    function viewInventory() {
                                    alert("Viewing inventory status: To be implemented with detailed inventory list.");
                                    addLogEntry("Viewed inventory status");
                                    }

                                    function viewEquipment() {
                                    alert("Viewing equipment health: To be implemented with equipment details.");
                                    addLogEntry("Viewed equipment health");
                                    }

                                    function compareSeasons() {
                                    alert("Comparing seasons: To be implemented with seasonal data comparison.");
                                    addLogEntry("Season comparison initiated");
                                    }

                                    function setPerformanceGoals() {
                                    alert("Setting performance goals: To be implemented with goal-setting interface.");
                                    addLogEntry("Performance goals setting initiated");
                                    }

                                    function viewFullLog() {
                                    alert("Viewing full activity log: To be implemented with complete log history.");
                                    addLogEntry("Viewed full activity log");
                                    }

                                    function clearLog() {
                                    const logList = document.getElementById('activityLog');
                                    logList.innerHTML = '';
                                    sensorData.logs = sensorData.logs.concat(sensorData.tasks);
                                    sensorData.tasks = [];
                                    addNotification("Activity Log Cleared", "All activities archived", "success");
                                    addLogEntry("Activity log cleared");
                                    }

                                    function exportLog() {
                                    const logExport = JSON.stringify(sensorData.logs.concat(sensorData.tasks), null, 2);
                                    const blob = new Blob([logExport], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'activity_log.json';
                                    a.click();
                                    URL.revokeObjectURL(url);
                                    addNotification("Activity Log Exported", "Activity log saved as JSON", "success");
                                    addLogEntry("Activity log exported");
                                    }

                                    // Settings Management
                                    function changeTheme() {
                                    const theme = document.getElementById('themeSelect').value;
                                    if (theme === 'dark') {
                                        document.body.style.background = 'linear-gradient(to bottom, #2e2e2e, #424242)';
                                        document.querySelector('.phone-frame').style.background = '#333';
                                        document.querySelector('.content').style.background = 'linear-gradient(to bottom, #424242, #616161)';
                                        document.querySelector('.nav-bar').style.background = '#424242';
                                        document.querySelectorAll('.section').forEach(s => s.style.background = '#424242');
                                    } else if (theme === 'nature') {
                                        document.body.style.background = 'linear-gradient(to bottom, #8bc34a, #c8e6c9)';
                                        document.querySelector('.phone-frame').style.background = '#f1f8e9';
                                        document.querySelector('.content').style.background = 'linear-gradient(to bottom, #f1f8e9, #dcedc8)';
                                        document.querySelector('.nav-bar').style.background = '#dcedc8';
                                        document.querySelectorAll('.section').forEach(s => s.style.background = '#f1f8e9');
                                    } else if (theme === 'custom') {
                                        alert("Custom theme to be implemented: Define your own colors.");
                                        document.body.style.background = 'linear-gradient(to bottom, #e8f5e9, #f5f5f5)';
                                    } else {
                                        document.body.style.background = 'linear-gradient(to bottom, #e8f5e9, #f5f5f5)';
                                        document.querySelector('.phone-frame').style.background = '#fff';
                                        document.querySelector('.content').style.background = 'linear-gradient(to bottom, #fff, #f8f9fa)';
                                        document.querySelector('.nav-bar').style.background = '#ffffff';
                                        document.querySelectorAll('.section').forEach(s => s.style.background = '#fff');
                                    }
                                    addLogEntry(`Theme changed to ${theme}`);
                                    }

                                    function setUpdateFrequency() {
                                    if (liveUpdate) {
                                        clearInterval(updateInterval);
                                        const freq = parseInt(document.getElementById('updateFreq').value);
                                        updateInterval = setInterval(updateSensorData, freq);
                                        addNotification("Update Frequency Set", `Data refresh set to every ${freq/1000} seconds`, "success");
                                        addLogEntry(`Update frequency set to ${freq/1000} seconds`);
                                    }
                                    }

                                    function updateUnits() {
                                    unitSystem = document.getElementById('unitSelect').value;
                                    updateSensorData();
                                    addNotification("Units Updated", `Switched to ${unitSystem} units`, "success");
                                    addLogEntry(`Units updated to ${unitSystem}`);
                                    }

                                    function updateLanguage() {
                                    language = document.getElementById('languageSelect').value;
                                    alert(`Language switched to ${language}: Full translation to be implemented.`);
                                    addLogEntry(`Language updated to ${language}`);
                                    }

                                    function saveSettings() {
                                    addNotification("Settings Saved", "All settings have been saved", "success");
                                    addLogEntry("Settings saved");
                                    }

                                    function resetSettings() {
                                    document.getElementById('themeSelect').value = 'light';
                                    document.getElementById('updateFreq').value = '5000';
                                    document.getElementById('notifyToggle').checked = true;
                                    document.getElementById('unitSelect').value = 'imperial';
                                    document.getElementById('languageSelect').value = 'en';
                                    document.getElementById('tempThreshold').value = '80';
                                    document.getElementById('humidThreshold').value = '60';
                                    document.getElementById('dataRetention').value = '30';
                                    document.getElementById('autoSync').checked = true;
                                    changeTheme();
                                    setUpdateFrequency();
                                    updateUnits();
                                    addNotification("Settings Reset", "All settings reset to default", "success");
                                    addLogEntry("Settings reset to default");
                                    }

                                    // Bulk Add Sensors
                                    function autoDetectSensors() {
                                    alert("Auto-detecting sensors: To be implemented with sensor discovery.");
                                    addNotification("Auto-Detect Initiated", "Searching for available sensors", "success");
                                    addLogEntry("Auto-detected sensors");
                                    }

                                    function bulkAddSensors() {
                                    alert("Bulk add sensors: To be implemented with multi-sensor deployment form.");
                                    addLogEntry("Bulk sensor addition initiated");
                                    }

                                    // Logging Utility
                                    function addLogEntry(entry) {
                                    sensorData.logs.push({ type: 'system', text: entry, time: new Date().toLocaleString() });
                                    const logList = document.getElementById('activityLog');
                                    logList.innerHTML = sensorData.tasks.map(t => `
                                        <div class="task-item">
                                            <div class="task-icon">
                                                <i class="fas fa-${t.status === 'completed' ? 'check-circle' : 'clock'}"></i>
                                            </div>
                                            <div class="task-content">
                                                <div class="task-title">${t.title}</div>
                                                <div class="task-details">${t.details} on ${t.time}</div>
                                            </div>
                                        </div>
                                    `).join('');
                                    }

                                    // Predictive Analytics Functions
                                    function predictCropHealth(cropType) {
                                    const crop = sensorData.crops[cropType];
                                    const healthScore = (crop.temp / (unitSystem === 'imperial' ? 80 : 26.7)) * 0.3 + 
                                                       (crop.humid / 70) * 0.3 + 
                                                       (crop.light / 15) * 0.2 + 
                                                       (crop.ph / 7.5) * 0.2;
                                    const healthStatus = healthScore > 0.9 ? "Excellent" : healthScore > 0.7 ? "Good" : "Poor";
                                    crop.health = healthStatus;
                                    document.getElementById(`${cropType.toLowerCase()}Health`).textContent = healthStatus;
                                    document.getElementById(`${cropType.toLowerCase()}HealthPred`).textContent = healthStatus;
                                    addNotification(`Health Predicted for ${cropType}`, `Predicted health: ${healthStatus}`, "info");
                                    addLogEntry(`Predicted health for ${cropType}: ${healthStatus}`);
                                    updateSensorData();
                                    }

                                    function optimizeIrrigation() {
                                    Object.keys(sensorData.crops).forEach(cropType => {
                                        const crop = sensorData.crops[cropType];
                                        if (crop.moisture < 60) {
                                            scheduleIrrigation(cropType);
                                            addNotification(`Auto-Irrigation for ${cropType}`, `${cropType} moisture below 60%, irrigation scheduled`, "success");
                                        }
                                    });
                                    addLogEntry("Irrigation optimized across all crops");
                                    }

                                    function detectSensorAnomalies() {
                                    sensorData.sensors.forEach(sensor => {
                                        if (sensor.temp > (unitSystem === 'imperial' ? 100 : 37.8) || sensor.temp < (unitSystem === 'imperial' ? 32 : 0)) {
                                            addNotification(`Anomaly Detected in ${sensor.id}`, `Temperature out of range: ${sensor.temp}${unitSystem === 'imperial' ? '°F' : '°C'}`, "warning");
                                        }
                                        if (sensor.humid > 95 || sensor.humid < 20) {
                                            addNotification(`Anomaly Detected in ${sensor.id}`, `Humidity out of range: ${sensor.humid}%`, "warning");
                                        }
                                        if (sensor.battery < 10) {
                                            addNotification(`Critical Battery in ${sensor.id}`, `Battery at ${sensor.battery}%`, "warning");
                                        }
                                    });
                                    addLogEntry("Sensor anomaly detection completed");
                                    }

                                    function analyzeWeatherImpact() {
                                    const tempImpact = sensorData.weather.temp > (unitSystem === 'imperial' ? 85 : 29.4) ? "High heat may stress crops" : "Temperature optimal";
                                    const humidImpact = sensorData.weather.humid < 50 ? "Low humidity may increase water needs" : "Humidity optimal";
                                    addNotification("Weather Impact Analysis", `${tempImpact}; ${humidImpact}`, "info");
                                    addLogEntry("Weather impact analyzed");
                                    }

                                    function toggleTaskAutomation() {
                                    const autoSync = document.getElementById('autoSync').checked;
                                    if (autoSync) {
                                        setInterval(() => {
                                            optimizeIrrigation();
                                            detectSensorAnomalies();
                                            analyzeWeatherImpact();
                                        }, 60000); // Runs every minute
                                        addNotification("Task Automation Enabled", "Automatic irrigation and anomaly detection activated", "success");
                                    } else {
                                        clearInterval();
                                        addNotification("Task Automation Disabled", "Manual control restored", "info");
                                    }
                                    addLogEntry(`Task automation ${autoSync ? 'enabled' : 'disabled'}`);
                                    }

                                    function planCropRotation() {
                                    alert("Crop rotation planner: To be implemented with rotation schedule generator.");
                                    addNotification("Crop Rotation Planned", "Rotation planner initiated", "success");
                                    addLogEntry("Crop rotation planning initiated");
                                    }

                                    function analyzeEconomics() {
                                    const waterCost = parseFloat(document.getElementById('waterCost').textContent.replace('$', '')) * 7;
                                    const fertilizerCost = parseFloat(document.getElementById('fertilizerCost').textContent.replace('$', ''));
                                    const totalWeeklyCost = waterCost + fertilizerCost;
                                    const yieldValue = (sensorData.crops['Corn'].yield * 5 + sensorData.crops['Wheat'].yield * 4 + sensorData.crops['Soybeans'].yield * 6) / 100 * 1000; // Hypothetical $ value
                                    const profit = yieldValue - totalWeeklyCost;
                                    addNotification("Economic Analysis", `Weekly Cost: $${totalWeeklyCost}, Estimated Yield Value: $${yieldValue}, Profit: $${profit}`, "info");
                                    addLogEntry("Economic analysis performed");
                                    }

                                    function scheduleMaintenancePrediction() {
                                    sensorData.sensors.forEach(sensor => {
                                        if (sensor.battery < 50) {
                                            addNotification(`Maintenance Predicted for ${sensor.id}`, `Battery below 50%, schedule maintenance`, "warning");
                                        }
                                    });
                                    addLogEntry("Predictive maintenance scheduled");
                                    }

                                    // New Chart Updates for Predictive, Resource, and Equipment Sections
                                    function updatePredictiveChart() {
                                    const ctx = document.getElementById('predictiveChart').getContext('2d');
                                    new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                            labels: ['Corn', 'Wheat', 'Soybeans'],
                                            datasets: [{
                                                label: 'Health Confidence (%)',
                                                data: [85, 90, 82],
                                                backgroundColor: 'rgba(76, 175, 80, 0.5)',
                                                borderColor: 'rgba(76, 175, 80, 1)',
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            scales: {
                                                y: { beginAtZero: true, max: 100 }
                                            }
                                        }
                                    });
                                    }

                                    function updateResourceChart() {
                                    const ctx = document.getElementById('resourceChart').getContext('2d');
                                    new Chart(ctx, {
                                        type: 'doughnut',
                                        data: {
                                            labels: ['Fertilizer (kg)', 'Water (gal)', 'Seeds (kg)'],
                                            datasets: [{
                                                data: [500, 1000, 200],
                                                backgroundColor: [
                                                    'rgba(76, 175, 80, 0.8)',
                                                    'rgba(33, 150, 243, 0.8)',
                                                    'rgba(255, 193, 7, 0.8)'
                                                ],
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            responsive: true
                                        }
                                    });
                                    }

                                    function updateEquipmentChart() {
                                    const ctx = document.getElementById('equipmentChart').getContext('2d');
                                    new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                            labels: ['Tractors', 'Irrigators', 'Harvesters'],
                                            datasets: [{
                                                label: 'Hours Used',
                                                data: [150, 80, 60],
                                                backgroundColor: 'rgba(76, 175, 80, 0.5)',
                                                borderColor: 'rgba(76, 175, 80, 1)',
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            scales: {
                                                y: { beginAtZero: true }
                                            }
                                        }
                                    });
                                    }

                                    // Resource and Equipment Management Functions
                                    function optimizeResourceUse() {
                                    alert("Optimizing resource usage: To be implemented with resource allocation algorithm.");
                                    addNotification("Resource Use Optimized", "Resource allocation optimized", "success");
                                    addLogEntry("Resource usage optimized");
                                    }

                                    function scheduleEquipmentMaintenance() {
                                    alert("Scheduling equipment maintenance: To be implemented with maintenance scheduler.");
                                    addNotification("Equipment Maintenance Scheduled", "Maintenance scheduled for all equipment", "success");
                                    addLogEntry("Equipment maintenance scheduled");
                                    }

                                    function viewEquipmentLogs() {
                                    alert("Viewing equipment logs: To be implemented with detailed equipment history.");
                                    addLogEntry("Viewed equipment logs");
                                    }

                                    // Form Submission for Adding Sensor
                                    document.addEventListener('DOMContentLoaded', function() {
                                        // Create all charts on page load
                                        function createCharts() {
                                            try {
                                                // Create overview chart only if the element exists and try each chart separately
                                                if(document.getElementById('overviewChart')) {
                                                    try { updateOverviewChart(); } catch(e) { console.error("Error with overview chart:", e); }
                                                }

                                                // Create crop overview chart
                                                if(document.getElementById('cropOverviewChart')) {
                                                    try { updateCropOverviewChart(); } catch(e) { console.error("Error with crop overview chart:", e); }
                                                }

                                                // Create sensor network charts
                                                if(document.getElementById('sensorNetworkChart')) {
                                                    try { updateSensorNetworkChart('sensorNetworkChart'); } catch(e) { console.error("Error with sensor network chart:", e); }
                                                }

                                                if(document.getElementById('sensorNetworkChartFull')) {
                                                    try { updateSensorNetworkChart('sensorNetworkChartFull'); } catch(e) { console.error("Error with full sensor network chart:", e); }
                                                }

                                                // Create weather trend chart
                                                if(document.getElementById('weatherTrendChart')) {
                                                    try { updateWeatherTrendChart(); } catch(e) { console.error("Error with weather trend chart:", e); }
                                                }

                                                // Create performance chart
                                                if(document.getElementById('performanceChart')) {
                                                    try { updatePerformanceChart(); } catch(e) { console.error("Error with performance chart:", e); }
                                                }

                                                // Individual charts - process only those that exist
                                                sensorData.sensors.forEach((_, index) => {
                                                    const chartId = `sensorChart${index + 1}`;
                                                    if(document.getElementById(chartId)) {
                                                        try { updateSensorChart(`Sensor ${index + 1}`); } catch(e) { console.error(`Error with ${chartId}:`, e); }
                                                    }
                                                });

                                                console.log("Charts initialization attempted");
                                            } catch(e) {
                                                console.error("Error in chart initialization:", e);
                                            }
                                        }

                                        // Add form submission handler
                                        const addSensorForm = document.getElementById('addSensorForm');
                                        if(addSensorForm) {
                                            addSensorForm.addEventListener('submit', function(e) {
                                                e.preventDefault();
                                                const id = document.getElementById('sensorId').value;
                                                const location = document.getElementById('location').value;
                                                const cropType = document.getElementById('cropType').value;
                                                const installDate = document.getElementById('installDate').value;
                                                const powerSource = document.getElementById('powerSource').value;
                                                const notes = document.getElementById('notes').value;
                                                const newSensor = {
                                                    id: id,
                                                    temp: 72,
                                                    humid: 65,
                                                    light: 14,
                                                    ph: 7.5,
                                                    battery: 100,
                                                    crop: cropType,
                                                    location: location,
                                                    status: 'Active',
                                                    lastCalibration: new Date().toLocaleDateString(),
                                                    installDate: installDate,
                                                    powerSource: powerSource,
                                                    notes: notes
                                                };
                                                sensorData.sensors.push(newSensor);
                                                const sensorGrid = document.getElementById('sensorGrid');
                                                const fullSensorGrid = document.getElementById('fullSensorGrid');
                                                const index = sensorData.sensors.length;
                                                const sensorHTML = `
                                                    <div class="sensor-card" onclick="toggleSensor(this, '${id}')">
                                                        <div class="sensor-header">
                                                            <i class="fas fa-microchip sensor-icon"></i>
                                                            <span class="sensor-title">${id}</span>
                                                            <span class="status-indicator active" title="Sensor Active"></span>
                                                        </div>
                                                        <div class="sensor-data">
                                                            <div>Temp: <span id="temp${index}">72°F</span></div>
                                                            <div>Humidity: <span id="humid${index}">65%</span></div>
                                                            <div>Light: <span id="light${index}">14 Dli</span></div>
                                                            <div>pH: <span id="ph${index}">7.5</span></div>
                                                            <div>Battery: <span id="battery${index}">100%</span></div>
                                                        </div>
                                                        <div class="sensor-details">
                                                            <div>Status: Active<span class="status-indicator active"></span></div>
                                                            <div>Location: ${location}</div>
                                                            <div>Crop Monitored: ${cropType}</div>
                                                            <div>Last Calibration: ${new Date().toLocaleDateString()}</div>
                                                            <div>Installation Date: ${installDate}</div>
                                                            <div>Sensor ID: ${id}</div>
                                                            <div>Last Reading: <span id="lastReading${index}">${new Date().toLocaleString()}</span></div>
                                                            <div>Signal Strength: 90%</div>
                                                            <div>Power Source: ${powerSource}</div>
                                                            <div>Firmware Version: 2.1.3</div>
                                                            <div>Operating Temp Range: 32°F - 120°F</div>
                                                            <div>Accuracy: ±0.5°F, ±2% RH</div>
                                                            <div>Maintenance Due: ${new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toLocaleDateString()}</div>
                                                            <div class="crop-info">
                                                                <div>Crop Type: ${cropType}</div>
                                                                <div>Variety: ${sensorData.crops[cropType].variety || 'Unknown'}</div>
                                                                <div>Health: ${sensorData.crops[cropType].health}</div>
                                                                <div>Water Need: ${sensorData.crops[cropType].water}</div>
                                                                <div>Growth Stage: ${sensorData.crops[cropType].stage}</div>
                                                                <div>Last Irrigation: ${sensorData.crops[cropType].lastIrrigation || 'N/A'}</div>
                                                                <div>Last Fertilized: ${sensorData.crops[cropType].lastFertilized || 'N/A'}</div>
                                                            </div>
                                                            <div class="progress-bar"><div class="progress-fill" style="width: 100%;" title="Battery Level"></div></div>
                                                            <div class="chart-container" style="height: 280px;">
                                                                <canvas id="sensorChart${index}"></canvas>
                                                            </div>
                                                            <div class="action-buttons">
                                                                <span class="btn" onclick="switchView('sensors')" title="View Full Sensor Details">Full View</span>
                                                                <span class="btn danger" onclick="deactivateSensor('${id}')" title="Deactivate Sensor">Deactivate</span>
                                                                <span class="btn info" onclick="calibrateSensor('${id}')" title="Calibrate Sensor">Calibrate</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `;
                                                if(sensorGrid) sensorGrid.innerHTML += sensorHTML;
                                                if(fullSensorGrid) {
                                                    fullSensorGrid.innerHTML += `
                                                        <div class="sensor-card" onclick="toggleSensor(this, '${id}')">
                                                            <div class="sensor-header">
                                                                <i class="fas fa-microchip sensor-icon"></i>
                                                                <span class="sensor-title">${id}</span>
                                                                <span class="status-indicator active" title="Sensor Active"></span>
                                                            </div>
                                                            <div class="sensor-data">
                                                                <div>Temp: <span id="temp${index}Full">72°F</span></div>
                                                                <div>Humidity: <span id="humid${index}Full">65%</span></div>
                                                                <div>Light: <span id="light${index}Full">14 Dli</span></div>
                                                                <div>pH: <span id="ph${index}Full">7.5</span></div>
                                                                <div>Battery: <span id="battery${index}Full">100%</span></div>
                                                            </div>
                                                            <div class="sensor-details">
                                                                <div>Status: Active<span class="status-indicator active"></span></div>
                                                                <div>Location: ${location}</div>
                                                                <div>Crop Monitored: ${cropType}</div>
                                                                <div>Last Calibration: ${new Date().toLocaleDateString()}</div>
                                                                <div>Installation Date: ${installDate}</div>
                                                                <div>Sensor ID: ${id}</div>
                                                                <div>Last Reading: <span id="lastReading${index}Full">${new Date().toLocaleString()}</span></div>
                                                                <div>Signal Strength: 90%</div>
                                                                <div>Power Source: ${powerSource}</div>
                                                                <div>Firmware Version: 2.1.3</div>
                                                                <div>Operating Temp Range: 32°F - 120°F</div>
                                                                <div>Accuracy: ±0.5°F, ±2% RH</div>
                                                                <div>Maintenance Due: ${new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toLocaleDateString()}</div>
                                                                <div class="crop-info">
                                                                    <div>Crop Type: ${cropType}</div>
                                                                    <div>Variety: ${sensorData.crops[cropType].variety || 'Unknown'}</div>
                                                                    <div>Health: ${sensorData.crops[cropType].health}</div>
                                                                    <div>Water Need: ${sensorData.crops[cropType].water}</div>
                                                                    <div>Growth Stage: ${sensorData.crops[cropType].stage}</div>
                                                                    <div>Last Irrigation: ${sensorData.crops[cropType].lastIrrigation || 'N/A'}</div>
                                                                    <div>Last Fertilized: ${sensorData.crops[cropType].lastFertilized || 'N/A'}</div>
                                                                </div>
                                                                <div class="progress-bar"><div class="progress-fill" style="width: 100%;" title="Battery Level"></div></div>
                                                                <div class="chart-container" style="height: 320px;">
                                                                    <canvas id="sensorChart${index}Full"></canvas>
                                                                </div>
                                                                <div class="action-buttons">
                                                                    <span class="btn info" onclick="calibrateSensor('${id}')" title="Calibrate This Sensor">Calibrate</span>
                                                                    <span class="btn danger" onclick="deactivateSensor('${id}')" title="Deactivate This Sensor">Deactivate</span>
                                                                    <span class="btn" onclick="viewSensorLogs('${id}')" title="View Sensor Logs">View Logs</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    `;
                                                }
                                                addNotification("Sensor Added", `${id} deployed at ${location} monitoring ${cropType}`, "success");
                                                addLogEntry(`Sensor ${id} added`);
                                                switchView('sensors');
                                                updateSensorData();
                                            });
                                        }

                                        // Initialize data updates
                                        try {
                                            // Initialize charts
                                            createCharts();

                                            // Update notifications
                                            updateNotifications();

                                            // Set initial values
                                            const elementsToUpdate = [
                                                { id: 'pendingTasks', value: sensorData.tasks.filter(t => t.status === 'pending').length },
                                                { id: 'completedTasks', value: sensorData.tasks.filter(t => t.status === 'completed' && new Date(t.time).toDateString() === new Date().toDateString()).length },
                                                { id: 'overdueTasks', value: '0' },
                                                { id: 'fertilizerStock', value: '500 kg' },
                                                { id: 'waterStock', value: '1000 gal' },
                                                { id: 'seedStock', value: '200 kg' },
                                                { id: 'equipMaintenance', value: '1' },
                                                { id: 'waterDaily', value: '500 gal' },
                                                { id: 'fertilizerWeekly', value: '50 kg' },
                                                { id: 'energyUse', value: '120 kWh' },
                                                { id: 'pestRisk', value: 'Low' },
                                                { id: 'diseaseIndex', value: '2/10' },
                                                { id: 'pestIncidents', value: '0' },
                                                { id: 'waterCost', value: '$50' },
                                                { id: 'fertilizerCost', value: '$200' },
                                                { id: 'totalCost', value: '$250' },
                                                { id: 'fertilizerStockFull', value: '500 kg' },
                                                { id: 'waterStockFull', value: '1000 gal' },
                                                { id: 'seedStockFull', value: '200 kg' },
                                                { id: 'waterUseFull', value: '500 gal' },
                                                { id: 'tractorHours', value: '150' },
                                                { id: 'irrigatorHours', value: '80' },
                                                { id: 'harvesterHours', value: '60' }
                                            ];

                                            // Safely update all elements
                                            elementsToUpdate.forEach(item => {
                                                const element = document.getElementById(item.id);
                                                if (element) {
                                                    element.textContent = item.value;
                                                }
                                            });

                                            // Update health predictions for all crops
                                            Object.keys(sensorData.crops).forEach(cropType => {
                                                const element = document.getElementById(`${cropType.toLowerCase()}HealthPred`);
                                                if (element) {
                                                    element.textContent = sensorData.crops[cropType].health;
                                                }

                                                // Initialize health predictions
                                                predictCropHealth(cropType);
                                            });

                                            // Set up automation toggle
                                            const autoSyncElement = document.getElementById('autoSync');
                                            if (autoSyncElement) {
                                                autoSyncElement.addEventListener('change', toggleTaskAutomation);
                                                if (autoSyncElement.checked) {
                                                    toggleTaskAutomation();
                                                }
                                            }

                                            // Set up periodic updates for advanced features
                                            setInterval(() => {
                                                if (liveUpdate) {
                                                    // Update crop health predictions
                                                    predictCropHealth('Corn');
                                                    predictCropHealth('Wheat');
                                                    predictCropHealth('Soybeans');

                                                    // Update economic analysis
                                                    analyzeEconomics();

                                                    // Check for maintenance needs
                                                    scheduleMaintenancePrediction();
                                                }
                                            }, 300000); // Every 5 minutes

                                            // Add initial log entry
                                            addLogEntry("Application initialized");

                                            console.log("AgriSense Pro dashboard initialized successfully");
                                        } catch (error) {
                                            console.error("Error during initialization:", error);
                                        }
                                    });

                                    // Function to safely update weather chart if it exists
                                    function updateWeatherChart() {
                                        const ctx = document.getElementById('weatherChart');
                                        if (!ctx) return;

                                        try {
                                            new Chart(ctx.getContext('2d'), {
                                                type: 'line',
                                                data: {
                                                    labels: Array(24).fill().map((_, i) => `${i}:00`),
                                                    datasets: [
                                                        {
                                                            label: 'Temperature',
                                                            data: Array(24).fill().map(() => sensorData.weather.temp + (Math.random() - 0.5) * 7),
                                                            borderColor: 'rgba(76, 175, 80, 1)',
                                                            backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                                            fill: true,
                                                            tension: 0.4
                                                        },
                                                        {
                                                            label: 'Humidity',
                                                            data: Array(24).fill().map(() => sensorData.weather.humid + (Math.random() - 0.5) * 15),
                                                            borderColor: 'rgba(33, 150, 243, 1)',
                                                            backgroundColor: 'rgba(33, 150, 243, 0.2)',
                                                            fill: true,
                                                            tension: 0.4
                                                        }
                                                    ]
                                                },
                                                options: {
                                                    responsive: true,
                                                    scales: {
                                                        y: { beginAtZero: false }
                                                    }
                                                }
                                            });
                                            
                                            // Update weather info in the weather page
                                            const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';
                                            document.getElementById('detailedWeatherTemp').textContent = `${sensorData.weather.temp.toFixed(1)}${tempUnit}`;
                                            document.getElementById('detailedWeatherHumid').textContent = `${sensorData.weather.humid.toFixed(1)}%`;
                                            
                                            // Generate random weather data
                                            const conditions = ['Sunny', 'Partly Cloudy', 'Cloudy', 'Light Rain', 'Clear'];
                                            const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                                            document.getElementById('detailedWeatherDesc').textContent = randomCondition;
                                            document.getElementById('weatherDesc').textContent = randomCondition;
                                        } catch (e) {
                                            console.error("Error creating weather chart:", e);
                                        }
                                    }
                                    
                                    // Function to display analytics for different data types
                                    function updateAnalyticsChart(type) {
                                        const ctx = document.getElementById('analyticsChart');
                                        if (!ctx) return;
                                        
                                        try {
                                            let chartData = {
                                                labels: Array(7).fill().map((_, i) => `Day ${i+1}`),
                                                datasets: []
                                            };
                                            
                                            const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';
                                            
                                            if (type === 'temperature') {
                                                chartData.datasets = [{
                                                    label: `Temperature (${tempUnit})`,
                                                    data: Array(7).fill().map(() => sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.temp), 0) / sensorData.sensors.length + (Math.random() - 0.5) * 5),
                                                    borderColor: 'rgba(255, 99, 132, 1)',
                                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                                    fill: true
                                                }];
                                            } else if (type === 'humidity') {
                                                chartData.datasets = [{
                                                    label: 'Humidity (%)',
                                                    data: Array(7).fill().map(() => sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.humid), 0) / sensorData.sensors.length + (Math.random() - 0.5) * 10),
                                                    borderColor: 'rgba(54, 162, 235, 1)',
                                                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                                    fill: true
                                                }];
                                            } else if (type === 'light') {
                                                chartData.datasets = [{
                                                    label: 'Light (Dli)',
                                                    data: Array(7).fill().map(() => sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.light), 0) / sensorData.sensors.length + (Math.random() - 0.5) * 2),
                                                    borderColor: 'rgba(255, 206, 86, 1)',
                                                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                                    fill: true
                                                }];
                                            } else if (type === 'ph') {
                                                chartData.datasets = [{
                                                    label: 'pH Level',
                                                    data: Array(7).fill().map(() => sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.ph), 0) / sensorData.sensors.length + (Math.random() - 0.5) * 0.5),
                                                    borderColor: 'rgba(75, 192, 192, 1)',
                                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                                    fill: true
                                                }];
                                            } else if (type === 'yield') {
                                                chartData.datasets = [{
                                                    label: 'Yield Forecast (%)',
                                                    data: Array(7).fill().map(() => {
                                                        const avgYield = (sensorData.crops['Corn'].yield + sensorData.crops['Wheat'].yield + sensorData.crops['Soybeans'].yield) / 3;
                                                        return avgYield + (Math.random() - 0.5) * 5;
                                                    }),
                                                    borderColor: 'rgba(153, 102, 255, 1)',
                                                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                                    fill: true
                                                }];
                                            } else if (type === 'battery') {
                                                chartData.datasets = [{
                                                    label: 'Battery Level (%)',
                                                    data: Array(7).fill().map(() => sensorData.sensors.reduce((sum, s) => sum + parseFloat(s.battery), 0) / sensorData.sensors.length - Math.random() * 3),
                                                    borderColor: 'rgba(255, 159, 64, 1)',
                                                    backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                                    fill: true
                                                }];
                                            }
                                            
                                            new Chart(ctx, {
                                                type: 'line',
                                                data: chartData,
                                                options: {
                                                    responsive: true,
                                                    maintainAspectRatio: false,
                                                    scales: {
                                                        y: {
                                                            beginAtZero: type === 'yield' || type === 'battery' || type === 'humidity'
                                                        }
                                                    }
                                                }
                                            });
                                            
                                            // Highlight the selected analytics type
                                            document.querySelectorAll('.analytics-view .sensor-card').forEach(card => {
                                                card.style.border = '1px solid var(--border-color)';
                                                card.style.boxShadow = 'var(--shadow-light)';
                                            });
                                            
                                            const selectedCard = document.querySelector(`.analytics-view .sensor-card[onclick*="${type}"]`);
                                            if (selectedCard) {
                                                selectedCard.style.border = '2px solid var(--primary-color)';
                                                selectedCard.style.boxShadow = 'var(--shadow-dark)';
                                            }
                                            
                                        } catch (e) {
                                            console.error("Error updating analytics chart:", e);
                                        }
                                    }
                                    
                                    // Function to update alert trend chart
                                    function updateAlertTrendChart() {
                                        const ctx = document.getElementById('alertTrendChart');
                                        if (!ctx) return;
                                        
                                        try {
                                            new Chart(ctx, {
                                                type: 'bar',
                                                data: {
                                                    labels: ['Temperature', 'Humidity', 'Battery', 'System', 'Connectivity', 'Crop Health'],
                                                    datasets: [{
                                                        label: 'Alerts This Week',
                                                        data: [
                                                            Math.floor(Math.random() * 3), 
                                                            Math.floor(Math.random() * 2), 
                                                            notifications.filter(n => n.text.includes('battery')).length,
                                                            Math.floor(Math.random() * 1),
                                                            Math.floor(Math.random() * 2),
                                                            Math.floor(Math.random() * 2)
                                                        ],
                                                        backgroundColor: [
                                                            'rgba(255, 99, 132, 0.5)',
                                                            'rgba(54, 162, 235, 0.5)',
                                                            'rgba(255, 206, 86, 0.5)',
                                                            'rgba(75, 192, 192, 0.5)',
                                                            'rgba(153, 102, 255, 0.5)',
                                                            'rgba(255, 159, 64, 0.5)'
                                                        ],
                                                        borderColor: [
                                                            'rgba(255, 99, 132, 1)',
                                                            'rgba(54, 162, 235, 1)',
                                                            'rgba(255, 206, 86, 1)',
                                                            'rgba(75, 192, 192, 1)',
                                                            'rgba(153, 102, 255, 1)',
                                                            'rgba(255, 159, 64, 1)'
                                                        ],
                                                        borderWidth: 1
                                                    }]
                                                },
                                                options: {
                                                    responsive: true,
                                                    scales: {
                                                        y: {
                                                            beginAtZero: true,
                                                            ticks: {
                                                                stepSize: 1
                                                            }
                                                        }
                                                    }
                                                }
                                            });
                                            
                                            // Update notification list
                                            updateNotifications();
                                            
                                        } catch (e) {
                                            console.error("Error updating alert trend chart:", e);
                                        }
                                    }
                                    
                                    // Function to update account usage chart
                                    function updateAccountUsageChart() {
                                        const ctx = document.getElementById('accountUsageChart');
                                        if (!ctx) return;
                                        
                                        try {
                                            new Chart(ctx, {
                                                type: 'doughnut',
                                                data: {
                                                    labels: ['Sensors Used', 'Sensors Available', 'Storage Used', 'Storage Available'],
                                                    datasets: [{
                                                        data: [sensorData.sensors.length, 20 - sensorData.sensors.length, 1.2, 3.8],
                                                        backgroundColor: [
                                                            'rgba(76, 175, 80, 0.8)',
                                                            'rgba(76, 175, 80, 0.2)',
                                                            'rgba(33, 150, 243, 0.8)',
                                                            'rgba(33, 150, 243, 0.2)'
                                                        ],
                                                        borderWidth: 1
                                                    }]
                                                },
                                                options: {
                                                    responsive: true,
                                                    plugins: {
                                                        legend: {
                                                            position: 'bottom'
                                                        }
                                                    }
                                                }
                                            });
                                        } catch (e) {
                                            console.error("Error updating account usage chart:", e);
                                        }
                                    }
                                    
                                    // Create sample sensor data when sensors page is loaded
                                    function populateSensorSampleData() {
                                        // Generate realistic sensor data with time series
                                        const sensorIds = ['Sensor 1', 'Sensor 2', 'Sensor 3', 'Sensor 4'];
                                        const locations = ['Corn Field A, Row 1', 'Corn Field A, Row 2', 'Wheat Field B, Row 1', 'Wheat Field B, Row 2'];
                                        const crops = ['Corn', 'Corn', 'Wheat', 'Wheat'];
                                        
                                        // Make sure all sensors have sample data
                                        sensorIds.forEach((sensorId, index) => {
                                            // Create sample temperature history
                                            const tempHistory = Array(24).fill().map(() => {
                                                return 70 + Math.sin(index + Math.random() * 10) * 5;
                                            });
                                            
                                            // Create sample humidity history
                                            const humidHistory = Array(24).fill().map(() => {
                                                return 60 + Math.cos(index + Math.random() * 10) * 10;
                                            });
                                            
                                            // Check if we already have data for this sensor
                                            const existingSensor = sensorData.sensors.find(s => s.id === sensorId);
                                            if (!existingSensor) {
                                                // Add sensor to the array if it doesn't exist
                                                sensorData.sensors.push({
                                                    id: sensorId,
                                                    temp: tempHistory[tempHistory.length - 1],
                                                    humid: humidHistory[humidHistory.length - 1],
                                                    light: 14 + (Math.random() - 0.5) * 2,
                                                    ph: 7.5 + (Math.random() - 0.5) * 0.5,
                                                    battery: 95 - index * 2,
                                                    crop: crops[index],
                                                    location: locations[index],
                                                    status: 'Active',
                                                    tempHistory: tempHistory,
                                                    humidHistory: humidHistory
                                                });
                                            } else {
                                                // Update existing sensor with history if needed
                                                if (!existingSensor.tempHistory) {
                                                    existingSensor.tempHistory = tempHistory;
                                                }
                                                if (!existingSensor.humidHistory) {
                                                    existingSensor.humidHistory = humidHistory;
                                                }
                                            }
                                            
                                            // Update visual elements for this sensor
                                            const tempUnit = unitSystem === 'imperial' ? '°F' : '°C';
                                            const updateElement = function(id, value) {
                                                const element = document.getElementById(id);
                                                if (element) element.textContent = value;
                                            };
                                            
                                            updateElement(`temp${index + 1}Full`, `${sensorData.sensors[index].temp.toFixed(1)}${tempUnit}`);
                                            updateElement(`humid${index + 1}Full`, `${sensorData.sensors[index].humid.toFixed(1)}%`);
                                            updateElement(`light${index + 1}Full`, `${sensorData.sensors[index].light.toFixed(1)} Dli`);
                                            updateElement(`ph${index + 1}Full`, sensorData.sensors[index].ph.toFixed(1));
                                            updateElement(`battery${index + 1}Full`, `${sensorData.sensors[index].battery.toFixed(1)}%`);
                                            updateElement(`lastReading${index + 1}Full`, new Date().toLocaleString());
                                            
                                            // Update the chart for this sensor
                                            setTimeout(() => updateSensorChart(`Sensor ${index + 1}`), 100);
                                        });
                                        
                                        // Update the sensor network overview chart
                                        setTimeout(() => updateSensorNetworkChart('sensorNetworkChartFull'), 200);
                                    }
                                    
                                    // Function to save settings when user clicks the button
                                    function saveSettings() {
                                        // Save all settings to local variables
                                        const theme = document.getElementById('themeSelect').value;
                                        const updateFreq = parseInt(document.getElementById('updateFreq').value);
                                        const notifyEnabled = document.getElementById('notifyToggle').checked;
                                        unitSystem = document.getElementById('unitSelect').value;
                                        language = document.getElementById('languageSelect').value;
                                        const tempThreshold = parseFloat(document.getElementById('tempThreshold').value);
                                        const humidThreshold = parseFloat(document.getElementById('humidThreshold').value);
                                        const dataRetention = document.getElementById('dataRetention').value;
                                        const autoSync = document.getElementById('autoSync').checked;
                                        
                                        // Apply theme immediately
                                        changeTheme();
                                        
                                        // Update frequency for live updates
                                        if (liveUpdate) {
                                            clearInterval(updateInterval);
                                            updateInterval = setInterval(updateSensorData, updateFreq);
                                        }
                                        
                                        // Show success notification
                                        addNotification("Settings Saved", "All settings have been saved successfully", "success");
                                        addLogEntry("Settings saved");
                                        
                                        // Return settings object for potential future use
                                        return {
                                            theme,
                                            updateFreq,
                                            notifyEnabled,
                                            unitSystem,
                                            language,
                                            tempThreshold,
                                            humidThreshold,
                                            dataRetention,
                                            autoSync
                                        };
                                    }
                                    
                                    // Enhanced switchView function to populate data for specific views
                                    function switchView(view) {
                                        console.log(`Switching to view: ${view}`);
                                        
                                        // Get all views
                                        const views = document.querySelectorAll('.view');
                                        
                                        // Hide all views first
                                        views.forEach(viewElement => {
                                            viewElement.classList.remove('active');
                                            viewElement.style.display = 'none';
                                        });
                                        
                                        // Show the selected view
                                        const selectedView = document.querySelector(`.${view}-view`);
                                        if (selectedView) {
                                            selectedView.classList.add('active');
                                            selectedView.style.display = 'block';
                                            console.log(`View ${view} activated`);
                                            
                                            // Update navigation highlighting
                                            updateNavHighlight(view);
                                            
                                            // Specific actions for each view
                                            if (view === 'sensors') {
                                                // Populate sensor data
                                                populateSensorSampleData();
                                            }
                                            else if (view === 'analytics') {
                                                // Default to temperature analysis
                                                setTimeout(() => updateAnalyticsChart('temperature'), 100);
                                            }
                                            else if (view === 'weather') {
                                                // Update weather chart and data
                                                setTimeout(() => updateWeatherChart(), 100);
                                            }
                                            else if (view === 'notifications') {
                                                // Update notifications list and chart
                                                updateNotifications();
                                                setTimeout(() => updateAlertTrendChart(), 100);
                                            }
                                            else if (view === 'account') {
                                                // Update account usage stats
                                                setTimeout(() => updateAccountUsageChart(), 100);
                                            }
                                            
                                            // Scroll to top of content area
                                            const contentArea = document.querySelector('.content');
                                            if (contentArea) {
                                                contentArea.scrollTop = 0;
                                            }
                                        } else {
                                            console.error(`View ${view} not found`);
                                            // Default to home if view not found
                                            const homeView = document.querySelector('.home-view');
                                            if (homeView) {
                                                homeView.classList.add('active');
                                                homeView.style.display = 'block';
                                                updateNavHighlight('home');
                                            }
                                        }
                                        
                                        // Fix navigation bar again after view switch
                                        const navBar = document.querySelector('.nav-bar');
                                        if (navBar) {
                                            navBar.setAttribute('style', 
                                                'position: fixed !important;' +
                                                'bottom: 18px !important;' +
                                                'z-index: 9999 !important;' +
                                                'left: 50% !important;' +
                                                'transform: translateX(-50%) !important;' +
                                                'width: calc(100% - 40px);' +
                                                'max-width: 320px;' +
                                                'transition: none !important;'
                                            );
                                        }
                                    }
                                    
                                    // Initialize sensor data with realistic values when page loads
                                    document.addEventListener('DOMContentLoaded', function() {
                                        // Make sure sensor data is initialized
                                        if (typeof sensorData === 'undefined') {
                                            window.sensorData = {
                                                sensors: [
                                                    { id: 'Sensor 1', temp: 72, humid: 65, light: 14, ph: 7.5, battery: 95, crop: 'Corn', location: 'Corn Field A, Row 1', status: 'Active' },
                                                    { id: 'Sensor 2', temp: 71, humid: 64, light: 13.8, ph: 7.4, battery: 88, crop: 'Corn', location: 'Corn Field A, Row 2', status: 'Active' },
                                                    { id: 'Sensor 3', temp: 73, humid: 66, light: 14.2, ph: 7.6, battery: 92, crop: 'Wheat', location: 'Wheat Field B, Row 1', status: 'Active' },
                                                    { id: 'Sensor 4', temp: 70, humid: 63, light: 13.5, ph: 7.3, battery: 90, crop: 'Wheat', location: 'Wheat Field B, Row 2', status: 'Active' }
                                                ],
                                                weather: { temp: 72, humid: 65, wind: 8, precip: 10 },
                                                crops: {
                                                    'Corn': { health: 'Good', water: 'Moderate', moisture: 65, temp: 72, light: 14, ph: 7.5, planting: '2023-04-15', harvest: '2023-09-30', stage: 'Flowering', yield: 85 },
                                                    'Wheat': { health: 'Excellent', water: 'Low', moisture: 63, temp: 71, light: 13.8, ph: 7.4, planting: '2023-03-20', harvest: '2023-08-15', stage: 'Grain Fill', yield: 90 },
                                                    'Soybeans': { health: 'Good', water: 'Moderate', moisture: 66, temp: 73, light: 14.5, ph: 7.6, planting: '2023-05-01', harvest: '2023-10-10', stage: 'Pod Setting', yield: 82 }
                                                }
                                            };
                                        }
                                        
                                        // Update sensor pages with current data
                                        const updateSensorPages = function() {
                                            // Update sensor data in sensors page
                                            sensorData.sensors.forEach((sensor, index) => {
                                                const updateElement = function(id, value) {
                                                    const element = document.getElementById(id);
                                                    if (element) element.textContent = value;
                                                };
                                                
                                                const tempUnit = 'F'; // Default to imperial
                                                
                                                // Update sensor card data
                                                updateElement(`temp${index + 1}`, `${sensor.temp}°${tempUnit}`);
                                                updateElement(`humid${index + 1}`, `${sensor.humid}%`);
                                                updateElement(`light${index + 1}`, `${sensor.light} Dli`);
                                                updateElement(`moisture${index + 1}`, `${sensor.moisture}%`);
                                                updateElement(`ph${index + 1}`, `${sensor.ph}`);
                                                
                                                // Update full sensor information
                                                updateElement(`lastReading${index + 1}`, `${new Date().toLocaleString()}`);
                                                updateElement(`lastReading${index + 1}Full`, `${new Date().toLocaleString()}`);
                                                
                                                // Update crop info if available
                                                if (sensor.stage) updateElement(`stage${index + 1}`, sensor.stage);
                                                if (sensor.planting) updateElement(`planting${index + 1}`, sensor.planting);
                                                if (sensor.harvest) updateElement(`harvest${index + 1}`, sensor.harvest);
                                                if (sensor.yield) updateElement(`yield${index + 1}`, `${sensor.yield}%`);
                                                updateElement(`light${index + 1}`, `${sensor.light} Dli`);                                                updateElement(`ph${index + 1}`, sensor.ph);
                                                updateElement(`battery${index + 1}`, `${sensor.battery}%`);
                                                
                                                // Update sensor full data
                                                updateElement(`temp${index + 1}Full`, `${sensor.temp}°${tempUnit}`);
                                                updateElement(`humid${index + 1}Full`, `${sensor.humid}%`);
                                                updateElement(`light${index + 1}Full`, `${sensor.light} Dli`);
                                                updateElement(`ph${index + 1}Full`, sensor.ph);
                                                updateElement(`battery${index + 1}Full`, `${sensor.battery}%`);
                                                
                                                // Update timestamps
                                                const currentTime = new Date().toLocaleString();
                                                updateElement(`lastReading${index + 1}`, currentTime);
                                                updateElement(`lastReading${index + 1}Full`, currentTime);
                                            });
                                            
                                            // Update sensor network chart
                                            setTimeout(function() {
                                                if (document.getElementById('sensorNetworkChartFull')) {
                                                    try {
                                                        updateSensorNetworkChart('sensorNetworkChartFull');
                                                    } catch (e) {
                                                        console.error("Error updating sensor network chart:", e);
                                                    }
                                                }
                                                
                                                // Update individual sensor charts
                                                sensorData.sensors.forEach((sensor, index) => {
                                                    const chartId = `sensorChart${index + 1}Full`;
                                                    if (document.getElementById(chartId)) {
                                                        try {
                                                            updateSensorChart(`Sensor ${index + 1}`);
                                                        } catch (e) {
                                                            console.error(`Error updating ${chartId}:`, e);
                                                        }
                                                    }
                                                });
                                            }, 300);
                                        };
                                        
                                        // Run once on page load
                                        updateSensorPages();
                                        
                                        // Add event listener to update data when the Sensors tab is clicked
                                        document.querySelectorAll('.nav-item').forEach(item => {
                                            if (item.textContent.includes('Sensors')) {
                                                item.addEventListener('click', updateSensorPages);
                                            }
                                        });
                                    });

                                    // Function to view full log
                                    function viewFullLog() {
                                        alert("Viewing full activity log: To be implemented with complete log history.");
                                        addLogEntry("Viewed full activity log");
                                    }
                                    
                                    // Fix for page scrolling issues
                                    document.addEventListener('DOMContentLoaded', function() {
                                        // Add scroll event listener to fix any scroll issues
                                        const contentDiv = document.querySelector('.content');
                                        if (contentDiv) {
                                            contentDiv.addEventListener('scroll', function() {
                                                // Ensure navigation bar stays visible
                                                const navBar = document.querySelector('.nav-bar');
                                                if (navBar) {
                                                    navBar.style.zIndex = '100';
                                                }
                                            });
                                        }
                                        
                                        // Ensure all sections fit properly
                                        const sections = document.querySelectorAll('.section');
                                        sections.forEach(section => {
                                            section.style.boxSizing = 'border-box';
                                            section.style.maxWidth = '100%';
                                        });
                                    });
                                    </script>
                                    </body>
                                    </html>